#!/usr/bin/python
####################################################################
# This script extracts the results of the test_suite script from a
# file to which the output has been directed and prints a summary of
# the success or failure of each program execution.
#
# This need only run properly under Linux to generate test
# summaries out of concatenated test job output.  It is called from
# the build_master script near the very end of a CESR build process.
#
# Useage : extract_test_summary <test_output_file>
#     i.e. extract_test_summary cesr_2007_0305_d.build.status
#
# Author : Matt Rendina
# Date   : 5 March 2007
####################################################################

import os
import sys
import shutil
import string
import time

if len(sys.argv) == 1:
  print "\nUsage: " + sys.argv[0] + " <file where test suite output resides>"
  sys.exit(0)
elif len(sys.argv) > 2:
  print "Invalid number of arguments."
  sys.exit(2)
else:
  file = sys.argv[1]

pad = ""
f = open(file, 'r')
lines = f.readlines()

for line in lines:
  if line.find("TEST COMPLETED") != -1:
    line = line.strip()
    chunks = line.split()
    returncode = chunks[5]
    name = chunks[0]
    if returncode == "0":
      status = "OK"
    else:
      status = "FAILED!"
    for i in range( 0,22-len(name) ):
      name = name + ' '
    name = name + " : " + status
    if returncode != "0":
      name = name + ' (' + str(returncode) + ')'
    time = int( chunks[-2] )
    for i in range( 0,40-len(name) ):
      name = name + ' '
    name = name + ' '
    
    string = name + "Test lasted: "+str( time ) + " s"
    print string

    
