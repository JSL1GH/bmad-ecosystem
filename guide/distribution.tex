\chapter{The Bmad Distribution}
\label{c:distribution}

\section{Libraries in the CESR Distribution}
\label{s:libs}

When installing \bmad\ on a computer what one gets is not only the
\bmad\ subroutine library but additionally subsidiary libraries upon
which subroutines in the \bmad\ library depend. There are 5 other
libraries that are used: \bn{cesr\_utils}, \bn{forest},
\bn{numerical\_recipes}, \bn{pgplot}, and \bn{dcslib}.
\begin{description}
\item[cesr\_utils] This is a small low level library that primarily defines 
the precision that \bmad\ works at (see below) and defines the physical
and mathematical constants (\vn{pi}, \vn{c_light}, etc.) that \bmad\ knows
about.
\item[dcslib] This library defines a set of miscellaneous helper routines. 
Routines include spline fitting, Gaussian random number generation,
etc. The library name comes from its creator.
\item[forest] This is the FPP/PTC 
(Fully Polymorphic Package / Polymorphic Tracking Code) library of
Etienne Forest that handles Taylor maps to any arbitrary order (this
is also known as Truncated Power Series Algebra (TPSA)). The FPP part
handles the TPSA and the PTC part does the physics of tracking through
elements using Lie Algebra with a Hamiltonian.  \bmad\ uses this
software to crate Taylor Maps, track particles, etc.  FPP/PTC is a
very general package and \bmad\ only makes use of a small part of its
features. For more information see the FPP/PTC web site at
\begin{example} 
    <http://bc1.lbl.gov/CBP_pages/educational/TPSA_DA/Introduction.html>
\end{example}

An important point to keep in mind is that Etienne defines his phase
space coordinates as $(x, p_x, y, p_y, p_z, ct = -z)$. \bmad uses
$(x, p_x, y, p_y, z, p_z)$. There are
\bmad\ routines for converting back and forth between the two 
representations and if you never call PTC directly then you don't
have to worry about the difference.

\item[recipes] Numerical Recipes is a set of subroutines for doing 
scientific computing including Runge--Kutta integration, FFT's,
interpolation and extrapolation, etc., etc. The write up for this
library is the book ``Numerical Recipes, The Art of Scientific
Computing''\cite{b:nr}. For \bmad\ this library has been modified to handle
both single and double precision reals.
\item[pgplot] The PGPLOT Graphics Subroutine Library is a Fortran or 
C-callable, device-independent graphics package for making simple
scientific graphs.  One disadvantage of PGPLOT is that it is not the
most friendly software for the programmer. To remedy this, there is a
set of Fortran90 wrapper subroutines called \bn{quick\_plot}. The
\bn{quick\_plot} suite is part of the dcslib library. Documentation
including a user's manual
may be obtained from the PGPLOT web site at
\begin{verbatim}
    <http://www.astro.caltech.edu/~tjp/pgplot>.
\end{verbatim}

\end{description}

\section{Precision}

\bmad\ comes in two flavors: One where the real numbers are single
precision and a version with double precision reals. Which version you
are working with is controlled by the parameter \vn{rp}\ (Real Precision)
which is defined in \bn{cesr\_utils}. [Note: For compatibility with older
programs the parameter \vn{rdef} is defined to be equal to \vn{rp}.]  On most
machines single precision has \vn{rp}\ = 4 and double precision has \vn{rp}\ =
8. Normally the double precision version is used since round-off
errors can be significant in some calculations. Long--term tracking is
an example where the single precision version is not adequate. 

To define your variables with the correct precision use the syntax
{\tt real(rp)}. For example:
\begin{example}
    real(rp) var1, var2, var3
\end{example}
When you want to define a literal constant, for example to pass an
argument to a subroutine, add the suffix \vn{_rp} to the end of the
constant. For example: \vn{2.0_rp} is equivalent to \vn{2.0D0} if
\vn{rp} is defined to be double precision. Notice that this is not
equivalent to \vn{2_rp} which defines an integer (not a real) constant.


