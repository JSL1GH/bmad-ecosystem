%-----------------------------------------------------------------
\section{Bmad\_Standard Matrix calculations and Tracking}
\label{s:bmad_standard}


\vn{Bmad_standard} transfer matrix calculations (\sref{s:tkm})
tracking (\sref{s:xfer} are meant to be quick. To this end the
paraxial approximation (\Eq{xpa1p}) is always used.


%-----------------------------------------
\index{Drift} 
\subsection{Drift}
The Hamiltonian for a drift is
\Begineq
  H = \frac{p_x^2 + p_y^2}{2 (1 + p_z)} 
\Endeq
This gives the map
\begin{align}
  x   &\rightarrow x + \frac{l \, p_x}{1 + p_z} \CRNO
  p_x &\rightarrow p_x  \CRNO
  y   &\rightarrow y + \frac{l \, p_y}{1 + p_z} \CRNO
  p_y &\rightarrow p_y  \\
  z   &\rightarrow z - \frac{l \, (p_x^2 + p_y^2)}{2 (1 + p_z)^2} \CRNO
  p_z &\rightarrow p_z \nonumber
\end{align}
The Jacobian is 
\Begineq
  \begin{pmatrix}
    x \\ p_x \\ z \\ p_z
  \end{pmatrix}
  = 
  \begin{pmatrix}
    1 & \frac{l}{1 + p_z}             & 0 & \frac{-l \, p_x}{(1 + p_z)^2} \\
    0 & 1                             & 0 & 0 \\
    0 & -\frac{l \, p_x}{(1 + p_z)^2} & 1 & 
                              \frac{l \, (p_x^2 + p_y^2)}{(1 + p_z)^3} \\
    0 & 0                             & 0 & 1
  \end{pmatrix}
\Endeq


%-----------------------------------------
\index{LCavity}
\subsection{LCavity}

The traversal time across a cavity is
\Begineq
  t_L = \int_0^L \frac{ds}{\beta \, c}
\Endeq
Writing
\Begineq
  \frac{1}{\beta} = \frac{E}{cP} = \frac{E}{sqrt{E^2 - m^2c^4}}
\Endeq
and assuming a constant gradient $G$ so that $E$ increases linearly
with length, the transit time is
\Begineq
  t_L = \frac{P_2 - P_1}{G}
\Endeq
Using this in \Eq{zbbzb} gives the change in $z$
\Begineq
  z_2 = \frac{\beta_2}{\beta_1} \, z_1 + 
  \beta_2 \, c \frac{P_{01} p_{z1} - P_{02} p_{z2}}{G}
\Endeq
where $P_{01}$ and $P_{02}$ are the reference momentum at the entrance
and exits of the \vn{LCavity}, and $p_{z1}$ and $p_{z2}$ are the
reference momentum.
