\chapter{Tracking}

With coord_structs:

1) In a subroutine where the coord_struct array is local and the ring_struct is passed as an argument to the routine. If the size of ring%ele_(:) does not change then the simplest allocation strategy is to use an automatic array:
      subroutine my_sub (ring, ...)
      type (ring_struct) ring
      type (coord_struct) orb_(0:ring%n_ele_ring)

Advantages: Simplicity
Disadvantages: Can be slow. coord_struct gets allocated and deallocated every time the routine is called. Also: cannot handle case when the number of ring%ele_(:) elements changes.

2) If time is am issue then the following is to be preferred (again the coord_struct is assumed local to the subroutine):

      type (coord_struct), allocatable, save :: orb_(:)
      ...
      call allocate_coord (orb_, ring%n_ele_ring)

Advantages: Minimal reallocation so fast.
  Can always handle case when size of ring%ele_(:) changes.
Disadvantages: Slightly more complicated, You always have the allocated array
  filling memory.

3) The "clean" way of doing things is:

      type (coord-struct), allocatable :: orb_(:)
      ...
      allocate (orb_(0:ring%n_ele_ring)
      ...
      deallocate (orb_)

Advantages: Clean
Disadvantages: Can be slow. coord_struct gets allocated and deallocated every
  time the routine is called.

-------------------------------------------------------------------

For other types of variables:

1) In each ele_struct there is for general use:
      ele%r(:)
      ele%ix_pointer
      ele%logic
These subelements are not used by BMAD.


2) For allocated arrays there are the following routines:
      reallocate_real
      reallocate_integer
      reallocate_logical
      reallocate_string

3) For pointer arrays Numerical Recipes has the overloaded reallocate function.
For example:
      integer, pointer :: int(:)
      ...
      int => reallocate (int, 500)





When using radiation excitation the random number generator is based
upon the fortran90 intrinsic random\_number. If random\_seed is not called
then the fluctuations from run to run will be exactly the same.


How to allocate coord\_struct arrays. 

  Switches to switch tracking

  Runge Kutta

  Boris

  Custom
    * how to setup

