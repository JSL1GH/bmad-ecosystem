\documentclass[11pt]{article}
%%\documentclass{book}
\usepackage{geometry}            % See geometry.pdf to learn the layout options. There are lots.
\usepackage{xspace}
\geometry{letterpaper}           % ... or a4paper or a5paper or ... 
%\geometry{landscape}            % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}   % To begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{alltt}
%\usepackage{epstopdf}
%\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}
\usepackage[T1]{fontenc}   % so _, <, and > print correctly in text.
\usepackage[strings]{underscore}    % to use "_" in text

\usepackage{hyperref}

%---------------------------------------------------------------------------------

\newcommand{\srthree}{\texttt{SYNRAD3D}\xspace}
\newcommand\ttcmd{\begingroup\catcode`\_=11 \catcode`\%=11 \dottcmd}
\newcommand\dottcmd[1]{\texttt{#1}\endgroup}
\newcommand{\Begineq}{\begin{equation}}
\newcommand{\Endeq}{\end{equation}}
\newcommand{\fig}[1]{Figure~\ref{#1}}
\newcommand{\vn}{\ttcmd}           
\newcommand{\Th}{$^{th}$\xspace}
\newcommand{\Newline}{\hfil \\}

\newlength{\dPar}
\newlength{\ExBeg}
\newlength{\ExEnd}
\setlength{\dPar}{1.5ex}
\setlength{\ExBeg}{-\dPar}
\addtolength{\ExBeg}{-0.5ex}
\setlength{\ExEnd}{-\dPar}
\addtolength{\ExEnd}{-0.0ex}

\newenvironment{example}
  {\vspace{\ExBeg} \begin{alltt}}
  {\end{alltt} \vspace{\ExEnd}}

%---------------------------------------------------------------------------------

\setlength{\textwidth}{6.25in}
\setlength{\hoffset}{0.0in}
\setlength{\oddsidemargin}{0.25in}
\setlength{\evensidemargin}{0.0in}
\setlength{\textheight}{8.5in}
\setlength{\topmargin}{0in}

\setlength{\parskip}{\dPar}
\setlength{\parindent}{0ex}

%---------------------------------------------------------------------------------

\title{ \srthree information}
\author{G. Dugan, D. Sagan}
\date{\today}                                      % Activate to display a given date or no date

\begin{document}
\maketitle

%------------------------------------------------------------------
\section{Introduction} 

\srthree is a program which simulates
the production and scattering of synchrotron radiation generated by an
electron beam in a high energy machine. The program was written by David
Sagan of Cornell University.

The principal motivation for this simulation is to estimate the
distribution of photon absorption sites around the vacuum chamber as a
function of longitudinal position in the machine. This information is
then input to simulation programs such as \vn{POSINST} and
\vn{ECLOUD}, which simulate photoelectron production in various
magnetic environments, which seeds the formation of the electron
cloud.

\srthree is not to be confused with an older program called
\vn{SYNRAD}. The \vn{SYNRAD} program is used for calculating
wall heating from the primary beam.  \vn{SYNRAD} only tracks
photons in the horizontal plane and does not simulate scattering of
the photons from the wall. The advantage of \vn{SYNRAD} is that it
is fast and directly gives wall heating numbers. The advantage of
\srthree is that it tracks photons in three dimensions and it does
simulate scattering from the wall.

%------------------------------------------------------------------------
\section{Simulation technique and physics models}
\subsection{Simulation technique} 

The \srthree program is based on the Monte
Carlo method. A section of the machine (which may be the complete machine)
is designated for photon generation.

The total number of photons generated is set by the user. \srthree
calculates how many photons need to be generated within each machine
element. \srthree then slices up each element longitudinally and
generates photons from each slice. The number of photons generated in
a slice weighted by the local probability of photon emission, which
depends on the instantaneous orbit curvature. A transverse location
and angle is selected for the photon generation which mirrors the
transverse distribution of the beam.

A photon is generated with a randomly chosen direction (relative to
the direction of the beam particle) and energy. The directions and
energies follow a distribution based on the standard synchrotron
radiation formulas. The photon is tracked from the point of origin to
the point at which it hits the vacuum chamber wall. The angle of
incidence relative to the local normal to the vacuum chamber is
computed. A scattering probability is computed, based on this angle
and the photon's energy. Depending on the value of this probability,
the photon is either absorbed at this location, or scattered. If it is
scattered, the scattering is taken to be specular (angle of reflection
equals angle of incidence) and elastic (photon energy does not
change).

The photon is then tracked to the next encounter with the vacuum
chamber wall, and the probability of scattering is again
computed. This process continues until the photon is absorbed.

%------------------------------------------------------------------
\subsection{Photon generation}

Photon generation is based on the standard synchrotron radiation
formulas, applicable for dipoles quadrupoles, and wigglers. The
radiation is assumed to be incoherent, so this program cannot treat
undulator radiation. Polarization of the photon is ignored.

The finite dimensions of the electron beam (both in position and
angle) are included in the simulation when the photon is
generated. One of the inputs to \srthree is the model lattice
to use and the simulation uses the lattice to compute the
variation of the beam size around the lattice, including dispersive
effects, is included. The ``wiggle" variation in the reference orbit
in a wiggler is included.

Typically the beam will not have a closed orbit distortion relative to
the reference orbit, but if one is included in the lattice, then
radiation due to the orbit distortion, for example, in a quadrupole,
is included.  

%------------------------------------------------------------------
\subsection{Photon scattering} 

Synchrotron radiation
photon scattering is treated as purely specular, with a scattering
probability which depends on the photon energy and polar angle with
respect to the chamber normal at the point of incidence.

The scattering probabilities are taken from an X-ray scattering
database at LBNL~\cite{b.henke}. The scattering probabilities depend on
the material of which the vacuum chamber is composed, and on the
surface condition (oxide coating, roughness, etc.) In principle, the
scattering probability also depends on the photon polarization
relative to the incident normal to the surface, but this dependence is
ignored in the simulation.

The scattering probabilities in the table currently used by the
simulation were computed for a photon p-polarization (electric field
in the plane of incidence), for an aluminum substrate with a 8 nm
layer of Al$_2$O$_3$, and a surface roughness of 2 nm. See
Fig.~\ref{f.reflect} for some example reflectivity curves, compared with
radiation spectra for wigglers and dipoles in CesrTA at 2 GeV.

\begin{figure}[tb]
\begin{center}
\includegraphics[width=5in]{reflectivity.eps}
\caption{Reflectivity vs. energy for several grazing angles. 
Points shown are a measurement from INFN~\cite{b.mehne}}
\label{f.reflect}
\end{center}
\end{figure}

%------------------------------------------------------------------
\subsection{Main input file} 

The main input file can be specified on the command line invoking synrad3d.
If not given, the default name for the main input file is ``\vn{synrad3d.init}''.
Example main input file:
\begin{example}
  &synrad3d_parameters
    ix_ele_track_start = 1    ! Radiation region start lattice element.
    ix_ele_track_end   = 912  ! Radiation region end lattice element.
    photon_direction = 1      ! 1 = Forward generation, -1 = Backward generation.
    num_photons      = 50000  ! Total number of photons generated. 
    ds_step_min      = 0.01   ! Photons are generated at discrete points. 
                              ! Multipole photons can be generated at each point.
                              ! This is minimum distance between points.
    emit_a       = -1         ! Horizontal emit. Meters. If < 0 -> Calc from lattice.
    emit_b       = 7.52E-11   ! Vertical emit.  Meters. If < 0 -> Calc from lattice.
    sig_e        = -1         ! Sig_E/E. If < 0 -> Calc from lattice.

    lattice_file = "../lattice/cesr/bmad/bmad_6wig_8nm_2085.lat" 
    wall_file    = "synrad3d.wall"   ! Vacuum chamber wall file.
    dat_file     = "synrad3d.dat"    ! Output data file.
    reflect_file = ''                ! If not blank: Write reflection data file. 

    sr3d_params%allow_reflections = T       ! For testing purposes.
    sr3d_params%stop_if_hit_antechamber = F !
    random_seed = 123456                    ! 0 -> Use sys clock.
    e_filter_min = -1           ! Min energy filter Output file photon filter
    e_filter_max = -1
    s_filter_min = -1
    s_filter_max = -1
    photon_start_input_file  = ''  ! File for initializing the photons
    photon_start_output_file = ''  ! File recording photon start positions
  /
\end{example}
Fortran namelist input is used.
The namelist begins on the line starting with \vn{"\&synrad3d_parameters"}
and ends with the line containing the slash \vn{"/"}. Anything outside
of this is ignored. Within the namelist, anything after an exclamation
mark \vn{"!"} is ignored including the exclamation mark. 

  \begin{description}
  \item[\vn{ix_ele_track_start}, \vn{ix_ele_track_end}] \Newline
The parameters \vn{ix_ele_track_start} and \vn{ix_ele_track_end} establish
the region where radiation is produced. These are the index numbers of 
elements in the lattice. The radiation region boundary is taken to be at
the exit end of the elements so no radiation is produced in the element
with index \vn{ix_ele_track_start}. If \vn{ix_ele_track_end} is negative,
the end of the radiation region is taken to be end of the lattice.
If \vn{ix_ele_track_end} is positive and less than \vn{ix_ele_track_start},
then the track region will be from \vn{ix_ele_track_start} through the
end of the lattice and from the beginning of the lattice to \vn{ix_ele_track_end}.
  \item[\vn{photon_direction}] \Newline
The \vn{photon_direction} parameter determines in what direction the photons
are traveling when initially created. A value of \vn{+1} indicates the photons
are created traveling in the $+s$ direction and a value of \vn{-1} indicates
that the photons are created in the $-s$ direction.
  \item[\vn{num_photons}] \Newline
The \vn{num_photons} establishes the approximate number of photons
generated.  The exact number of photons shown in the output file may vary
slightly. If filtering is enabled (see below), the number of photons shown
in the output file will approximately be in the range [0.9 * num_photons, 2 * num_photons]
  \item[\vn{ds_step_min}] \Newline
This parameter establishes the minimum distance to track a the particle beam between emission
points. The thought was that if \srthree decided to make very small steps  between emission
points, this might slow the calculation down. This has not been tested...
  \item[\vn{emit_a}, \vn{emit_b}, \vn{sig_e}] \Newline
These parameters set the particle beam size and so will affect the starting coordinates of
the photons. A negative set of any of these parameters will result in \srthree 
using the value for the parameter from a calculation of the synchrotron radiation integrals.
  \item[\vn{lattice_file}] \Newline
This file defines the
machine optics. The lattice file format may be the Bmad format or, if
the \vn{lattice_file} string is prefixed by \vn{``xsif::''},
may be in xsif format.
  \item[\vn{wall_file}] \Newline
This string gives the name of the vacuum chamber wall definition file. See below for
more details.
  \item[\vn{dat_file}] \Newline
This string gives the name of the output data file.
See below for more details.
  \item[\vn{sr3d_params\%allow_reflections}] \Newline
This parameter, if set False, will cause \srthree to stop tracking a given photon once
it hits the chamber wall.
  \item[\vn{sr3d_params\%stop_if_hit_antechamber}] \Newline
This parameter, if set True, will cause \srthree to stop tracking a given photon once
it hits part of an antechamber wall.
  \item[\vn{reflect_file}] \Newline
This string, if not blank, will create a data file listing the reflection points for all
the photons. This will be in addition
to the regular output file.
See below for more details.
  \item[\vn{random_seed}] \Newline
Random number see used in by the random number generator. If set to 0, the system clock
will be used. That is, if set to 0, the output results will vary from run to run. 
  \item[\vn{e_filter_min}, \vn{e_filter_max}] \Newline
Minimum and maximum energy filter values. A negative filter value
indicates that the particular filter is not used. See below.
  \item[\vn{s_filter_min}, \vn{s_filter_max}] \Newline
Minimum and maximum longitudinal position filter values. A negative filter value
indicates that the particular filter is not used. See below.
  \item[\vn{photon_start_output_file}] \Newline
This string, if not blank, will cause \srthree to create an output
file, with a name given by the value of \vn{photon_start_output_file},
of the photon starting positions along with the state of the random
number generator. This is useful for diagnostic purposes. Note: If
\vn{photon_start_input_file} is set, \vn{photon_start_outpu_file} will
be ignored (no output file is generated).
  \item[\vn{photon_start_input_file}] \Newline
This string, if not blank, will cause \srthree to initialize photon
starting positions using the values in an input file. The name of the
input file being given by the value of \vn{photon_start_input_file}.
The state of the random number generator at the time of a photon's
initialization can also be specified in the file. In this case, the
random number generator state will also be set along with the state of
the photon. This is useful for diagnostic purposes.

\end{description}

The four "filter" parameters are:
\begin{example}
  e_filter_min   ! min energy filter.
  e_filter_max   ! max energy filter.
  s_filter_min   ! min longitudinal position filter.
  s_filter_max   ! max longitudinal position filter.
\end{example}
A filter parameter is "unset" if its value is negative and is "set"
otherwise.  \srthree can run in "filtered" or "unfiltered"
mode. Unfiltered mode occurs when none of the filter parameters have
have been set. In this mode, all photons generated are recorded in
the output file.

In filtered mode, with at least one of the filter parameters set,
photons that do not satisfy the set filter values are discarded. The
filter parameters are compared against the final photon position and
energy. If both \vn{s_filter_min} and \vn{s_filter_max} have been set,
and \vn{s_filter_min} is greater than \vn{s_filter_max}, the region
for keeping a photon is from \vn{s_filter_min} through the end of the
lattice along with the region from the start of the lattice to
\vn{s_filter_max}. 

In filtered mode, \srthree will generate a set of approximately
\vn{num_photons} photons in the radiation production region.  After
filtering, \srthree will check to see if the number of unfiltered
photons is at least 0.9 * \vn{num_photons}. If so, photon generation
will stop. If not enough photons have been generated, \srthree will
generate another \vn{num_photons}, and so on, until at least 0.9 *
\vn{num_photons} unfiltered photons have been generated. 

%------------------------------------------------------------------
\subsection{Vacuum chamber wall definition} 

\begin{figure}[tb]
\begin{center}
\includegraphics[width=5in]{chamber.eps}
\caption{Example vacuum chamber cross-section. The example is for an elliptical
chamber with an antechamber on the $+x$ side of the chamber and an
aperture on the $-x$ side.}
\label{f.chamber}
\end{center}
\end{figure}

The vacuum chamber wall is defined by specifying the chamber
cross-section at a number of longitudinal positions. An example
cross-section is shown in \fig{f.chamber}. The parameters needed to
specify the chamber at a given longitudinal position are:
\begin{example}
  s                   ! Longitudinal position
  basic_shape          ! Either "elliptical" or "rectangular"
  width2              ! Half width ignoring antechamber.
  height2             ! Half height ignoring antechamber.
  width2_plus         ! Distance from pipe center to +x side edge.
  ante_height2_plus   ! Antechamber half height on +x side of the wall
  width2_minus        ! Distance from pipe center -x side edge.
  ante_height2_minus  ! Antechamber half height on -x side of the wall
\end{example}

The basic chamber shape at a given position is given by the
\vn{basic_shape} attribute which my be set to either
\vn{"rectangular"} or \vn{"elliptical"}. The example in
\fig{f.chamber} is elliptical. \vn{width2} and \vn{height2} define the
half-height and half-width of the basic shape. 

Antechambers on the $+x$ side and/or $-x$ side of the chamber can be
added to the basic shape. On the $+x$ side, an antechamber is formed
if the \vn{ante_height2_plus} parameter is set to a positive value. If
\vn{ante_height2_plus} is set to a positive value, as shown in
\fig{f.chamber}, the parameter \vn{width2_plus} specifies the
horizontal distance from the chamber center to the far end of the $+x$
side antechamber. In this case, the value of \vn{width2_plus} must be
large enough so that the antechamber far wall does not stick back into
the basic shape. For a rectangular shape, this translates to
\vn{width2_plus} being larger than \vn{width2}. Similarly, if
\vn{ante_height2_minus} is set to a positive value, an antechamber is
formed on the $-x$ side.  In this case, \vn{width2_minus} is the
(positive) horizontal distance from the chamber center to the far end
of the $-x$ antechamber.

If \vn{ante_height2_plus} is not set, a set of \vn{width2_plus}
defines an aperture on the $+x$ side of the chamber. In this case, the
value of \vn{width2_plus} must be less than the value of
\vn{width2}. Similarly, if \vn{ante_height2_minus} is not set, a set of
\vn{width2_minus} defines an aperture on the $-x$ side of the chamber.
A $-x$ aperture is shown in \fig{f.chamber}.

Once a set of chamber cross-sections have been defined, the
cross-section of the chamber at a given longitudinal position is
computed using a linear interpolation: In cylindrical coordinates,
let $r_{w1}(\theta)$ be the radius of the wall as a function of
$\theta$ at some point $s_1$ where the chamber cross-section has been
defined. Let $r_{w2}(\theta)$ be the radius of the wall at the next
defined cross-section at $s_2$. The radius of the wall cross-section,
$r_w(\theta, s)$ at some position $s$ with $s_1 \le s \le s_2$ is
\Begineq
  r_w(\theta, s) = \frac{s_2 - s}{s_2 - s_1} \, r_{w1} + \frac{s_1 - s}{s_1 - s_2} \, r_{w2}
\Endeq
Note: The foregoing construction works as long as $r_{w1}$ and
$r_{w2}$ are single valued functions. Thus, it would be a fairly
simple matter in the future to extend the wall definition syntax to include more
complicated cross-sections as long as the $r_w$ remains single valued.

To determine if a photon at position $(r, \theta, s)$ is inside or outside the
chamber, the normalized radius $r_n$ is evaluated:
\Begineq
  r_n(r, \theta, s) = r / r_w(\theta, s)
\Endeq
The photon is outside if $r_n > 1$ and inside if $r_n < 1$. The wall
itself is defined by the equation $r_n = 1$. This being the case, the
gradient $\nabla r_n$, evaluated at the chamber wall, gives a vector
that is outward normal to the surface. This is useful when calculating
the angle of the photon as it reflects off the surface. Actually,
\srthree calculates the gradient of $-1/r_n$ expressed in $(x, y, s)$
coordinates as this turns out to be especially easy to evaluate.

An example wall definition file is:
\begin{example}
  ! Anything outside the namelist is ignored.
  &synrad3d_wall
   wall_pt(0) = 0.0, "elliptical", 0.045, 0.025
   wall_pt(1) = 74.307, "elliptical", 0.045, 0.025
   wall_pt(2) = 82.971, "rectangular", 0.045, 0.025
   wall_pt(3) = 91.176, "rectangular", 0.045, 0.025,
                            -1, -1, 0.08, 0.01
   wall_pt(4) = 101.300, "elliptical", 0.045, 0.025
   wall_pt(5) = 0.0, "elliptical", 0.045, 0.025
  /
\end{example}
Fortran namelist input is used. 
The namelist begins on the line starting with \vn{"\&synrad3d_wall"}
and ends with the line containing the slash \vn{"/"}. Anything outside
of this is ignored. Within the namelist, anything after an exclamation
mark \vn{"!"} is ignored including the exclamation mark. 

In the namelist, \vn{wall_pt(i)} gives the parameters for the $i$\Th
cross-section The format for a \vn{wall_pt} is
\begin{example}
  wall_pt(i) = s, basic_shape, width2, height2, width2_plus, ante_height2_plus, 
                  width2_minus, ante_height2_minus
\end{example}
Possible \vn{basic_shape} values are
\begin{example}
  "elliptical"
  "rectangular"
\end{example}

The index $i$ of \vn{wall_pt(i)} runs from zero which gives the
cross-section at the beginning of the lattice up to the index for the
last cross-section at the end of the lattice. The $s$ values for the
wall points must be in increasing order starting at $s = 0$ for
\vn{wall_pt(i)}. The exception is that the $s$ value for the last
\vn{wall_pt(i)} is immaterial since \srthree will automatically substitute
the appropriate $s$ value at the end of the lattice.

For each \vn{wall_pt(i)} the first four parameters -- \vn{s},
\vn{basic_shape}, \vn{width2}, and \vn{height2} -- must be
specified. Values for the other parameters are optional and default to
the ``unset'' value of -1.

%------------------------------------------------------------------
\section{Output files} 

%------------------------------------------------------------------
\subsection{Main output file}
The first 20 lines of this file echo the
information provided in the file \vn{synrad3d.init}.
Subsequently, \vn{dat_file} contains 4 lines for each photon
generated. An example of the output generated for two photons is shown
below.
\begin{example}
 1       2     71.52  6.614E-03  ! index, n_reflect, eV, intensity
    0.000542    0.000037   -0.000073    0.000080       9.015    1.000000  ! Start position
    0.015165    0.004010    0.023538    0.017410      18.661    0.999840  ! End position
      37   DRIFT             ! Lat ele index and class
       2       1     11.25  6.614E-03  ! index, n_reflect, eV, intensity
   -0.000604   -0.000046    0.000003    0.000826       9.036    1.000000  ! Start position
    0.013187   -0.004171   -0.023902   -0.009377      15.524    0.999947  ! End position
      36   SBEND             ! Lat ele index and class
\end{example}
The first line gives the photon index number, the number of times the
photon struck the vacuum chamber before absorption, the photon energy
(in eV), and the photon intensity.

The photon intensity is always the same for all photons in a given
run. If $N_{\gamma}$ is the total number of photons per beam particle
emitted in one revolution, then the photon intensity in a simulation
run containing $N_{sim}$ photons is defined as $I=N_{\gamma}/N_{sim}.$
Thus, if a simulation run is done using $N_{sim}$ photons, and $N_L$
is the number of photon absorption sites in a longitudinal region of
length $L$, then the average number of photons per beam particle per
unit length absorbed in this region is $(N_L/L)\times I.$ This number
is needed as input for electron cloud simulation programs.

In the second line, the initial position of the generated photon is
given. The six numbers are $x$ (m), $v_x/c$, $y$ (m), $v_y/c$, $s$
(m), and $v_s/c.$ $x$ is the horizontal position (direction along the
local normal to the closed orbit, in the bend plane, zero on the
closed orbit, positive to the outside of the machine, ), $y$ is the
vertical position (direction perpendicular to the bend plane, zero on
the closed orbit, positive up), and $s$ is the longitudinal position
(direction tangent to the closed orbit, zero at the beginning of the
lattice, positive in the direction of motion of the beam).

The third line gives the position of the point at which the photon is absorbed.

The fourth line gives the lattice element index and element type for
the longitudinal position at which the photon is absorbed. This is
provided so that the photon hits can be sorted by magnetic environment
(e.g., drift, sbend, wiggler, etc.)  


%------------------------------------------------------------------
\subsection{Photon Reflection File}


If the switch \vn{reflect_file} is non-blank, an additional output
file is generated, which contains more detailed information. An
example of the output generated for 4 photons is shown below. (This
example is not for the same run as in the previous section).
\begin{example}
*********************************************
       1       0    1.0000    0.0000    0.0000              0.031988    0.135670
    0.045000    0.031988    0.000086    0.000031   70.549655    0.999488
 *********************************************
       2       0    1.0000    0.0000    0.0000              0.031988    0.733201
    0.045000    0.031988    0.001106    0.000393   70.549655    0.999488
               -0.031988                0.000393                0.999488
 *********************************************
       2       1    1.0000    0.0000    0.0000              0.022632    0.803131
    0.045000    0.022632    0.003817    0.000393   77.441042    0.999744
               -0.022632                0.000393                0.999744
 *********************************************
       2       2    1.0000    0.0000    0.0000              0.022632    0.803131
    0.045000    0.022632    0.005382    0.000393   81.419627    0.999744
               -0.022632                0.000393                0.999744
 *********************************************
       2       3    1.0000    0.0000    0.0000              0.026406    0.774138
    0.045000    0.026406    0.007719    0.000393   87.361447    0.999651
 *********************************************
       3       0    1.0000    0.0000    0.0000              0.031988    0.547595
    0.045000    0.031988   -0.000434   -0.000154   70.549655    0.999488
               -0.031988               -0.000154                0.999488
 *********************************************
       3       1    1.0000    0.0000    0.0000              0.022632    0.691365
    0.045000    0.022632   -0.001498   -0.000154   77.441042    0.999744
 *********************************************
       4       0    1.0000    0.0000    0.0000              0.031988    0.135670
    0.045000    0.031988    0.000088    0.000031   70.549655    0.999488
\end{example}
Individual entries are separated by a row of asterisks. Each entry
corresponds to a photon striking the vacuum chamber. There may be one
or more entries for each photon, depending on the number of times it
strikes the vacuum chamber before being absorbed.

The first line in the first entry starts with two integers: the photon
index, followed by the number of reflections. For the first entry for
each photon, the number of reflections will always be zero. In the
example shown, the next three real numbers are always 1.0, 0.0 and
0.0. The following real number is $\cos{\theta_\perp}$, the angle
relative to the surface normal with which the photon strikes the
wall. The grazing angle is $\theta_g=\pi/2-\theta_\perp.$ The last
real number in this line is the probability of reflection, computed
from the X-ray data for the given grazing angle and photon energy.

The following line gives the 6-coordinate position of the photon when
it strikes the chamber (same conventions as given in the previous
section). If it is reflected, there is a third line which gives the
new direction of the scattered photon ($v_x$ changes sign, but $v_y$
and $v_s$ are unchanged, corresponding to specular reflection).

In the example given above, the first photon is absorbed at the first
encounter with the vacuum chamber. The second photon reflects 3 times,
the third photon reflects once, and the fourth photon is absorbed
immediately, like the first one.

%------------------------------------------------------------------
\begin{thebibliography}{9}

\bibitem{b.henke} 
B.L. Henke, E.M. Gullikson, and J.C. Davis. X-ray
interactions: photoabsorption, scattering, transmission, and
reflection at E=50-30000 eV,=1-92, Atomic Data and Nuclear Data
Tables Vol. 54 (no.2), 181-342 (July 1993) {\tt
http://henke.lbl.gov/optical\_constants/}

\bibitem{b.mehne}
N. Mahne et. al., ``Experimental Determination of ECLOUD Simulation Input
Parameters for DA$\Phi$NE", EuroTev-Report-2005-013

\end{thebibliography}
\end{document}  
