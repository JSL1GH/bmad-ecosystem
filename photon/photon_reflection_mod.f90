module photon_reflection_mod

use precision_def
use physical_constants

integer, private, parameter :: N_energy=98, N_angles=16
real(rp), private, save :: ang_vec(N_angles) = (/ 0,1,2,3,4,5,6,7,10,15,20,30,45,60,75,90 /)
real(rp), private, save :: energy_vec(N_energy), reflect_vec(N_angles,N_energy)
real(rp), private, save :: y2(N_angles,N_energy)
logical, save, private :: init_needed = .true.

contains

!---------------------------------------------------------------------------------------------
!---------------------------------------------------------------------------------------------
!---------------------------------------------------------------------------------------------

! initialization routine for photrefp
! read in tables for interpolation

Subroutine photon_reflection_init

  use nr

  implicit none

  character(100) datafile
  character(100) line

  integer i, j

  ! init

  energy_vec = (/ 30.0, 40.0, 50.0, 60.0, 70.0, 80.0, 90.0, 100.0, 110.0, 120.0, &
        130.0, 140.0, 150.0, 160.0, 170.0, 180.0, 190.0, 200.0, 210.0, 220.0, &
        230.0, 240.0, 250.0, 260.0, 270.0, 280.0, 290.0, 300.0, 310.0, 320.0, &
        330.0, 340.0, 350.0, 360.0, 370.0, 380.0, 390.0, 400.0, 410.0, 420.0, &
        430.0, 440.0, 450.0, 460.0, 470.0, 480.0, 490.0, 500.0, 510.0, 520.0, &
        530.0, 540.0, 550.0, 560.0, 570.0, 580.0, 590.0, 600.0, 610.0, 620.0, &
        630.0, 640.0, 650.0, 660.0, 670.0, 680.0, 690.0, 700.0, 710.0, 720.0, &
        730.0, 740.0, 750.0, 760.0, 770.0, 780.0, 790.0, 800.0, 810.0, 820.0, &
        830.0, 840.0, 850.0, 860.0, 870.0, 880.0, 890.0, 900.0, 910.0, 920.0, &
        930.0, 940.0, 950.0, 960.0, 970.0, 980.0, 990.0, 1000.0 /)

  reflect_vec(:,  1) = (/ 1.000000, 0.923630, 0.852910, 0.787263, 0.726194, 0.669267, 0.616103, 0.566372, 0.435039, 0.263631, 0.137873, 0.003234, 0.001180, 0.000727, 0.001980, 0.002673 /)
  reflect_vec(:,  2) = (/ 1.000000, 0.914839, 0.836482, 0.764004, 0.696633, 0.633721, 0.574715, 0.519143, 0.369149, 0.156553, 0.008207, 0.004792, 0.000364, 0.000747, 0.002038, 0.002560 /)
  reflect_vec(:,  3) = (/ 1.000000, 0.907185, 0.822053, 0.743165, 0.669344, 0.599597, 0.533044, 0.468867, 0.281784, 0.040299, 0.020329, 0.005244, 0.000101, 0.000548, 0.001287, 0.001540 /)
  reflect_vec(:,  4) = (/ 1.000000, 0.876644, 0.765027, 0.660928, 0.560698, 0.460587, 0.356528, 0.250923, 0.107430, 0.045740, 0.021179, 0.003942, 0.000023, 0.000353, 0.000731, 0.000852 /)
  reflect_vec(:,  5) = (/ 1.000000, 0.797371, 0.636611, 0.509502, 0.409164, 0.329940, 0.267264, 0.217511, 0.120393, 0.047830, 0.019475, 0.002769, 0.000003, 0.000258, 0.000501, 0.000580 /)
  reflect_vec(:,  6) = (/ 1.000000, 0.841165, 0.706888, 0.592949, 0.496061, 0.413634, 0.343601, 0.284271, 0.157157, 0.055118, 0.018563, 0.001819, 0.000005, 0.000124, 0.000241, 0.000281 /)
  reflect_vec(:,  7) = (/ 1.000000, 0.845503, 0.713926, 0.601244, 0.504400, 0.421059, 0.349420, 0.288059, 0.154703, 0.048860, 0.014359, 0.001109, 0.000003, 0.000067, 0.000134, 0.000157 /)
  reflect_vec(:,  8) = (/ 1.000000, 0.844784, 0.712489, 0.598954, 0.501079, 0.416552, 0.343642, 0.281025, 0.145071, 0.040963, 0.010558, 0.000670, 0.000001, 0.000042, 0.000085, 0.000100 /)
  reflect_vec(:,  9) = (/ 1.000000, 0.843757, 0.710551, 0.596065, 0.497137, 0.411458, 0.337346, 0.273563, 0.135384, 0.033808, 0.007563, 0.000403, 0.000001, 0.000028, 0.000057, 0.000066 /)
  reflect_vec(:, 10) = (/ 1.000000, 0.842813, 0.708773, 0.593417, 0.493520, 0.406765, 0.331513, 0.266606, 0.126259, 0.027518, 0.005272, 0.000245, 0.000000, 0.000019, 0.000038, 0.000045 /)
  reflect_vec(:, 11) = (/ 1.000000, 0.846440, 0.714661, 0.600327, 0.500353, 0.412587, 0.335580, 0.268421, 0.121416, 0.022239, 0.003534, 0.000146, 0.000000, 0.000012, 0.000024, 0.000028 /)
  reflect_vec(:, 12) = (/ 1.000000, 0.847463, 0.716095, 0.601482, 0.500548, 0.411213, 0.332178, 0.262769, 0.110971, 0.016632, 0.002241, 0.000092, 0.000000, 0.000008, 0.000016, 0.000019 /)
  reflect_vec(:, 13) = (/ 1.000000, 0.847936, 0.716603, 0.601475, 0.499443, 0.408468, 0.327381, 0.255745, 0.099909, 0.012106, 0.001404, 0.000061, 0.000000, 0.000005, 0.000011, 0.000013 /)
  reflect_vec(:, 14) = (/ 1.000000, 0.849048, 0.718178, 0.602765, 0.499676, 0.406917, 0.323466, 0.249184, 0.088796, 0.008536, 0.000869, 0.000042, 0.000000, 0.000004, 0.000008, 0.000009 /)
  reflect_vec(:, 15) = (/ 1.000000, 0.849912, 0.719332, 0.603514, 0.499271, 0.404630, 0.318701, 0.241677, 0.077548, 0.005888, 0.000543, 0.000029, 0.000000, 0.000003, 0.000005, 0.000006 /)
  reflect_vec(:, 16) = (/ 1.000000, 0.852839, 0.724046, 0.608864, 0.504099, 0.407789, 0.319152, 0.238724, 0.068450, 0.004020, 0.000341, 0.000021, 0.000000, 0.000002, 0.000004, 0.000004 /)
  reflect_vec(:, 17) = (/ 1.000000, 0.858405, 0.733220, 0.619729, 0.514717, 0.416189, 0.323465, 0.237613, 0.058127, 0.002595, 0.000212, 0.000014, 0.000000, 0.000001, 0.000003, 0.000003 /)
  reflect_vec(:, 18) = (/ 1.000000, 0.862059, 0.739107, 0.626306, 0.520288, 0.418917, 0.321558, 0.229973, 0.046230, 0.001630, 0.000137, 0.000010, 0.000000, 0.000001, 0.000002, 0.000002 /)
  reflect_vec(:, 19) = (/ 1.000000, 0.864957, 0.743680, 0.631119, 0.523660, 0.418912, 0.316237, 0.218374, 0.035009, 0.001016, 0.000092, 0.000007, 0.000000, 0.000001, 0.000001, 0.000002 /)
  reflect_vec(:, 20) = (/ 1.000000, 0.867167, 0.747034, 0.634260, 0.524879, 0.416129, 0.307353, 0.202790, 0.025410, 0.000635, 0.000064, 0.000005, 0.000000, 0.000000, 0.000001, 0.000001 /)
  reflect_vec(:, 21) = (/ 1.000000, 0.868010, 0.747969, 0.634138, 0.522105, 0.408662, 0.293255, 0.182559, 0.017927, 0.000408, 0.000047, 0.000004, 0.000000, 0.000000, 0.000001, 0.000001 /)
  reflect_vec(:, 22) = (/ 1.000000, 0.868608, 0.748479, 0.633443, 0.518576, 0.400127, 0.277739, 0.161584, 0.012587, 0.000268, 0.000035, 0.000003, 0.000000, 0.000000, 0.000001, 0.000001 /)
  reflect_vec(:, 23) = (/ 1.000000, 0.869093, 0.748781, 0.632424, 0.514498, 0.390585, 0.260689, 0.140025, 0.008758, 0.000179, 0.000027, 0.000002, 0.000000, 0.000000, 0.000000, 0.000001 /)
  reflect_vec(:, 24) = (/ 1.000000, 0.869713, 0.749314, 0.631658, 0.510528, 0.380677, 0.242718, 0.118934, 0.006079, 0.000123, 0.000021, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 25) = (/ 1.000000, 0.871206, 0.751406, 0.632955, 0.508822, 0.372634, 0.225708, 0.099769, 0.004209, 0.000086, 0.000016, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 26) = (/ 1.000000, 0.873681, 0.755198, 0.636343, 0.509008, 0.365152, 0.207182, 0.080861, 0.002850, 0.000061, 0.000012, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 27) = (/ 1.000000, 0.875698, 0.758148, 0.638462, 0.507226, 0.354333, 0.184807, 0.062983, 0.001919, 0.000044, 0.000010, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 28) = (/ 1.000000, 0.877463, 0.760624, 0.639822, 0.504066, 0.340722, 0.159984, 0.047634, 0.001289, 0.000033, 0.000007, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 29) = (/ 1.000000, 0.879036, 0.762735, 0.640556, 0.499626, 0.324251, 0.133994, 0.035277, 0.000867, 0.000025, 0.000006, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 30) = (/ 1.000000, 0.880457, 0.764547, 0.640741, 0.493918, 0.304769, 0.108476, 0.025783, 0.000585, 0.000020, 0.000005, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 31) = (/ 1.000000, 0.881739, 0.766085, 0.640393, 0.486857, 0.282072, 0.085085, 0.018704, 0.000396, 0.000015, 0.000004, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 32) = (/ 1.000000, 0.882900, 0.767371, 0.639523, 0.478339, 0.256087, 0.065058, 0.013521, 0.000269, 0.000012, 0.000003, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 33) = (/ 1.000000, 0.883935, 0.768396, 0.638090, 0.468152, 0.226933, 0.048854, 0.009760, 0.000185, 0.000010, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 34) = (/ 1.000000, 0.884720, 0.768917, 0.635705, 0.455606, 0.194939, 0.036249, 0.007042, 0.000128, 0.000008, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 35) = (/ 1.000000, 0.884984, 0.768436, 0.631684, 0.439896, 0.161962, 0.026861, 0.005109, 0.000091, 0.000007, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 36) = (/ 1.000000, 0.885225, 0.767888, 0.627357, 0.422529, 0.131073, 0.019979, 0.003722, 0.000066, 0.000006, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 37) = (/ 1.000000, 0.885449, 0.767270, 0.622660, 0.403117, 0.103616, 0.014899, 0.002716, 0.000049, 0.000005, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 38) = (/ 1.000000, 0.885644, 0.766557, 0.617524, 0.381343, 0.080539, 0.011141, 0.001985, 0.000037, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 39) = (/ 1.000000, 0.885792, 0.765714, 0.611871, 0.356913, 0.061987, 0.008352, 0.001451, 0.000029, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 40) = (/ 1.000000, 0.885893, 0.764740, 0.605665, 0.329641, 0.047513, 0.006275, 0.001062, 0.000024, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 41) = (/ 1.000000, 0.885942, 0.763626, 0.598869, 0.299540, 0.036419, 0.004723, 0.000777, 0.000020, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 42) = (/ 1.000000, 0.886133, 0.762744, 0.591999, 0.267325, 0.027974, 0.003558, 0.000568, 0.000018, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 43) = (/ 1.000000, 0.886417, 0.761986, 0.584761, 0.232890, 0.021478, 0.002675, 0.000415, 0.000016, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 44) = (/ 1.000000, 0.886550, 0.760878, 0.576391, 0.197077, 0.016503, 0.002009, 0.000305, 0.000015, 0.000002, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 45) = (/ 1.000000, 0.886538, 0.759435, 0.566871, 0.162171, 0.012709, 0.001511, 0.000227, 0.000015, 0.000002, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 46) = (/ 1.000000, 0.886313, 0.757523, 0.555930, 0.130275, 0.009806, 0.001140, 0.000173, 0.000016, 0.000002, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 47) = (/ 1.000000, 0.885852, 0.755101, 0.543447, 0.102964, 0.007590, 0.000867, 0.000139, 0.000017, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 48) = (/ 1.000000, 0.885095, 0.752058, 0.529213, 0.080682, 0.005902, 0.000673, 0.000121, 0.000019, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 49) = (/ 1.000000, 0.883883, 0.748103, 0.512804, 0.063037, 0.004630, 0.000544, 0.000118, 0.000022, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 50) = (/ 1.000000, 0.881610, 0.742113, 0.492838, 0.049295, 0.003711, 0.000484, 0.000137, 0.000028, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 51) = (/ 1.000000, 0.876814, 0.731527, 0.467043, 0.038997, 0.003200, 0.000537, 0.000202, 0.000043, 0.000007, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 52) = (/ 1.000000, 0.837560, 0.666826, 0.406574, 0.039489, 0.006459, 0.002196, 0.001048, 0.000210, 0.000033, 0.000008, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 53) = (/ 1.000000, 0.666556, 0.404251, 0.162926, 0.006091, 0.001012, 0.000697, 0.000441, 0.000098, 0.000016, 0.000004, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 54) = (/ 1.000000, 0.699636, 0.443395, 0.169003, 0.002921, 0.000161, 0.000294, 0.000216, 0.000048, 0.000008, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 55) = (/ 1.000000, 0.710809, 0.456262, 0.163190, 0.002018, 0.000080, 0.000227, 0.000166, 0.000036, 0.000006, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 56) = (/ 1.000000, 0.718205, 0.464220, 0.152854, 0.001488, 0.000082, 0.000200, 0.000139, 0.000029, 0.000005, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 57) = (/ 1.000000, 0.723902, 0.469855, 0.139123, 0.001147, 0.000107, 0.000185, 0.000120, 0.000025, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 58) = (/ 1.000000, 0.728577, 0.474020, 0.122734, 0.000924, 0.000137, 0.000175, 0.000107, 0.000021, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 59) = (/ 1.000000, 0.732559, 0.477135, 0.104756, 0.000779, 0.000166, 0.000166, 0.000096, 0.000019, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 60) = (/ 1.000000, 0.736050, 0.479459, 0.086752, 0.000686, 0.000190, 0.000159, 0.000088, 0.000017, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 61) = (/ 1.000000, 0.739232, 0.481237, 0.070306, 0.000629, 0.000209, 0.000152, 0.000080, 0.000015, 0.000002, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 62) = (/ 1.000000, 0.742331, 0.482800, 0.056391, 0.000596, 0.000223, 0.000144, 0.000073, 0.000014, 0.000002, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 63) = (/ 1.000000, 0.745388, 0.484187, 0.045132, 0.000578, 0.000232, 0.000136, 0.000067, 0.000013, 0.000002, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 64) = (/ 1.000000, 0.748275, 0.485172, 0.036197, 0.000566, 0.000236, 0.000128, 0.000062, 0.000012, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 65) = (/ 1.000000, 0.750829, 0.485451, 0.029144, 0.000556, 0.000236, 0.000120, 0.000057, 0.000011, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 66) = (/ 1.000000, 0.752647, 0.484347, 0.023569, 0.000546, 0.000234, 0.000113, 0.000053, 0.000010, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 67) = (/ 1.000000, 0.754014, 0.482301, 0.019221, 0.000540, 0.000230, 0.000106, 0.000049, 0.000010, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 68) = (/ 1.000000, 0.755293, 0.479889, 0.015839, 0.000537, 0.000226, 0.000100, 0.000046, 0.000009, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 69) = (/ 1.000000, 0.756808, 0.477607, 0.013199, 0.000536, 0.000220, 0.000094, 0.000044, 0.000009, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 70) = (/ 1.000000, 0.758458, 0.475263, 0.011103, 0.000532, 0.000213, 0.000089, 0.000041, 0.000008, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 71) = (/ 1.000000, 0.760077, 0.472537, 0.009415, 0.000526, 0.000205, 0.000083, 0.000038, 0.000008, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 72) = (/ 1.000000, 0.761591, 0.469249, 0.008045, 0.000519, 0.000196, 0.000078, 0.000036, 0.000007, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 73) = (/ 1.000000, 0.763028, 0.465409, 0.006928, 0.000509, 0.000187, 0.000074, 0.000034, 0.000007, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 74) = (/ 1.000000, 0.764387, 0.460933, 0.006012, 0.000498, 0.000178, 0.000069, 0.000032, 0.000007, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 75) = (/ 1.000000, 0.765716, 0.455845, 0.005258, 0.000486, 0.000169, 0.000065, 0.000030, 0.000006, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 76) = (/ 1.000000, 0.767063, 0.450115, 0.004636, 0.000473, 0.000161, 0.000061, 0.000029, 0.000006, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 77) = (/ 1.000000, 0.768414, 0.443600, 0.004117, 0.000458, 0.000152, 0.000058, 0.000027, 0.000006, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 78) = (/ 1.000000, 0.769744, 0.436119, 0.003681, 0.000443, 0.000144, 0.000054, 0.000026, 0.000005, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 79) = (/ 1.000000, 0.770999, 0.427382, 0.003309, 0.000426, 0.000136, 0.000051, 0.000025, 0.000005, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 80) = (/ 1.000000, 0.772189, 0.417188, 0.002992, 0.000409, 0.000128, 0.000049, 0.000023, 0.000005, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 81) = (/ 1.000000, 0.773320, 0.405213, 0.002719, 0.000392, 0.000120, 0.000046, 0.000022, 0.000005, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 82) = (/ 1.000000, 0.774377, 0.391021, 0.002484, 0.000375, 0.000114, 0.000043, 0.000021, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 83) = (/ 1.000000, 0.775308, 0.373996, 0.002277, 0.000358, 0.000107, 0.000041, 0.000020, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 84) = (/ 1.000000, 0.776121, 0.353493, 0.002096, 0.000342, 0.000101, 0.000039, 0.000019, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 85) = (/ 1.000000, 0.776852, 0.328690, 0.001937, 0.000326, 0.000095, 0.000037, 0.000018, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 86) = (/ 1.000000, 0.777513, 0.298823, 0.001799, 0.000310, 0.000090, 0.000035, 0.000017, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 87) = (/ 1.000000, 0.778141, 0.263925, 0.001677, 0.000296, 0.000085, 0.000034, 0.000017, 0.000004, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 88) = (/ 1.000000, 0.778735, 0.225670, 0.001569, 0.000282, 0.000081, 0.000032, 0.000016, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 89) = (/ 1.000000, 0.779303, 0.188044, 0.001472, 0.000268, 0.000077, 0.000031, 0.000015, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 90) = (/ 1.000000, 0.779840, 0.154709, 0.001386, 0.000255, 0.000073, 0.000030, 0.000015, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 91) = (/ 1.000000, 0.780480, 0.127289, 0.001309, 0.000243, 0.000070, 0.000028, 0.000014, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 92) = (/ 1.000000, 0.781148, 0.105486, 0.001239, 0.000231, 0.000066, 0.000027, 0.000014, 0.000003, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 93) = (/ 1.000000, 0.781801, 0.088198, 0.001174, 0.000220, 0.000063, 0.000026, 0.000013, 0.000003, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 94) = (/ 1.000000, 0.782436, 0.074439, 0.001114, 0.000208, 0.000060, 0.000025, 0.000013, 0.000003, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 95) = (/ 1.000000, 0.783043, 0.063374, 0.001058, 0.000198, 0.000057, 0.000024, 0.000012, 0.000003, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 96) = (/ 1.000000, 0.783604, 0.054369, 0.001006, 0.000188, 0.000055, 0.000023, 0.000012, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 97) = (/ 1.000000, 0.784129, 0.047003, 0.000956, 0.000179, 0.000052, 0.000022, 0.000011, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)
  reflect_vec(:, 98) = (/ 1.000000, 0.784611, 0.040889, 0.000910, 0.000170, 0.000050, 0.000021, 0.000011, 0.000002, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 /)

  !  set up for spine interpolation

  call splie2(ang_vec, energy_vec, reflect_vec, y2)

end subroutine

!---------------------------------------------------------------------------------------------
!---------------------------------------------------------------------------------------------
!---------------------------------------------------------------------------------------------

! evaluate using spline interpolation
! angle is in degrees,  energy is in eV,  
! ref is the reflectivity, a pure number between 0 and 1.

subroutine photon_reflectivity (angle, energy,  ref)

  use nr

  implicit none

  real(rp) angle, angle_deg, energy, energym, ref

  !

  if (init_needed) then
    call photon_reflection_init
    init_needed = .false.
  endif

  energym = max(30.0_rp, energy)
  energym = min(1000.0_rp, energym)

  angle_deg = angle * 180 / pi
  ref = max(0.0_rp, splin2 (ang_vec, energy_vec, reflect_vec, y2, angle_deg, energym))

end subroutine

end module
