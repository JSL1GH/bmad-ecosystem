\chapter{Miscellaneous Statements}

This chapter deals with the statements not covered in the previous chapters.

%-----------------------------------------------------------------------------
\section{Parameter Statement}
\label{s:param}
\index{parameter statement|hyperbf}


\index{lattice}
\index{lattice_type}
\index{taylor_order}
\index{e_tot}
\index{p0c}
\index{ran_seed}
\index{n_part}
The \vn{parameter} statement is used to set the \vn{lattice} name and
other variables.  The variables that can be set by \vn{parameter} is
\begin{example}
  parameter[lattice]      = <String>        ! Lattice name 
  parameter[lattice_type] = <Switch>        ! 
  parameter[taylor_order] = <Integer>       ! Default: 3
  parameter[e_tot]        = <Real>          ! Reference total Energy. 
                                            !      Default: 1000 * rest_energy.
  parameter[p0c]          = <Real>          ! Reference momentum.
  parameter[n_part]       = <Real>          ! Number of particles in a bunch.
  parameter[ran_seed]     = <Integer>       ! Random number generator init.
  parameter[particle]     = <particle_type> ! Eg: positron, antiproton, etc.
  parameter[aperture_limit_on] = <Logical>  ! Use aperture limits in tracking.
\end{example}

\noindent
Examples
\begin{example}
  parameter[lattice]      = "L9A19C501.FD93S_4S_15KG"
  parameter[lattice_type] = circular_lattice
  parameter[taylor_order] = 5
  parameter[E_tot]  = 5.6e9    ! eV
\end{example}

For more information on \vn{parameter[ran_seed]} see \sref{s:functions}.

Valid \vn{particle} switches are:
\index{positron}\index{electron}\index{proton}\index{antiproton}
\begin{example}
  positron  ! default
  electron
  proton
  antiproton
\end{example}

\index{e_tot}
\index{e_tot}
\index{lcavity}
\index{patch}
\index{p0c}
The \vn{parameter[e_tot]} and \vn{parameter[p0c]} are the reference
total energy and momentum at the start of the lattice.  Each element
in a lattice has an individual reference \vn{e_tot} and \vn{p0c} attributes
which are dependent parameters. The reference energy and momentum will only
change between \vn{LCavity} or \vn{Patch} elements. The starting
reference energy, if not set, will be set to 1000 time the particle
rest energy.  Note: \vn{beginning[e_tot]} and \vn{beginning[p0c]} are
equivalent to \vn{parameter[e_tot]} and \vn{parameter[p0c]}.

\index{beambeam}
\index{n_part}
\index{lcavity}
The \vn{parameter[n_part]} is the number of particle in a bunch.
it is used with \vn{BeamBeam} elements and is used to calculate the
change in energy through an \vn{Lcavity}. See~\sref{s:lcav} for more
details.

\index{aperture_limit_on}
Aperture limits may be set for elements in the lattice
(\sref{s:limit}). Setting \vn{aperture_limit_on} to \vn{False} will
disable all set apertures. \vn{True} is the default.

\index{lattice statement}
The \vn{lattice} name is stored by \bmad for use by a program but it does
not otherwise effect any \bmad routines. 
Historically it is possible to set the lattice name using the syntax
\begin{example}
  lattice = <String>   ! DO NOT USE THIS SYNTAX
\end{example}
This syntax is obsolete since a typographical error cannot be caught.

\noindent
\index{circular_lattice}
\index{linear_lattice}
\index{lcavity!and lattice_type}
Valid \vn{lattice_type} switches are
\begin{example}
  circular_lattice  ! Default w/o LCavity element present.
  linear_lattice    ! Default if LCavity elements present.
\end{example}
a \vn{circular_lattice} is for a closed lat where one expects a
periodic solution for the Twiss parameters. A \vn{linear_lattice} is
not closed so that the initial Twiss parameters need to be given, not
computed. Although \vn{circular_lattice} is the nominal default, If
there are \vn{Lcavity} elements present, \vn{linear_lattice} will be used
as the default.

\index{taylor_order statement}
\index{taylor_order}
The Taylor order (\sref{s:taylor.phys}) is set by
\vn{parameter[taylor_order]} and is the maximum order for a Taylor map.
Historically it is possible to set the Taylor order using the syntax
\begin{example}
  taylor_order = <Integer>   ! DO NOT USE THIS SYNTAX
\end{example}
This syntax is obsolete since a typographical error is not easily caught.

%-----------------------------------------------------------------------------
\section{Beam_start Statement}
\label{s:beam.start}
\index{beam_start statement|hyperbf}

\index{x}
\index{px}
\index{y}
\index{py}
\index{z}
\index{pz}
\index{emittance_a}
\index{emittance_b}
\index{emittance_z}
The \vn{beam_start} statement is used to set the starting coordinates
for particle tracking
\begin{example}
  beam_start[x]    = <Real> ! Horizontal position.
  beam_start[px]   = <Real> ! Horizontal momentum.
  beam_start[y]    = <Real> ! Vertical position.
  beam_start[py]   = <Real> ! Vertical momentum.
  beam_start[z]    = <Real> ! Longitudinal position.
  beam_start[pz]   = <Real> ! Longitudinal momentum (energy deviation).
  beam_start[emittance_a] = <Real> ! A-mode emittance
  beam_start[emittance_b] = <Real> ! B-mode emittance
  beam_start[emittance_z] = <Real> ! Z-mode emittance
\end{example}

\noindent
Examples
\begin{example}
  beam_start[y] = 2 * beam_start[x]
\end{example}

%-----------------------------------------------------------------------------
\section{Beam Statement}
\index{beam statement|hyperbf}

\index{energy}
\index{particle}
\index{n_part}
\index{MAD!beam statement}
The \vn{beam} statement is provided for compatibility with \mad. The syntax is
\begin{example}
  beam, energy = GeV, pc = GeV, particle = <Switch>, n_part = <Real>
\end{example}
For example
\index{MAD}
\begin{example}
  beam, energy = 5.6  ! Note: GeV to be compatible with \mad
  beam, particle = electron, n_part = 1.6e10
\end{example}
Setting the reference energy using the \vn{energy} attribute is the
same as using \vn{parameter[e_tot]}. Similarly, setting \vn{pc} is
equivalent to setting \vn{parameter[p0c]}. Valid \vn{particle} switches
are the same as \vn{parameter[particle]}.

%-----------------------------------------------------------------------------
\section{Title Statement}
\index{title statement|hyperbf}

The \vn{title} statement sets a title string which can be used by a program. 
For consistency with \mad there are two possible syntaxes
\begin{example}
  title, <String>
\end{example}
or the statement can be split into two lines
\begin{example}
  title
  <String>
\end{example}
For example
\begin{example}
  title
  "This is a title"
\end{example}

%--------------------------------------------------------------------------
\section{Call Statement}
\label{s:call}
\index{call statement|hyperbf}

It is frequently convenient to separate the lattice definition into
several files.  Typically there might be a file (or files) that define
the layout of the lattice (something that doesn't change often) and a
file (or files) that define magnet strengths (something that changes
more often).  The \vn{call} is used to read in separated lattice
files. The syntax is
\begin{example}
  call, filename = <String>
\end{example}
Example:
\begin{example}
  call, filename = "../layout/my_layout.bmad"      ! Relative pathname
  call, filename = "/nfs/cesr/lat/my_layout.bmad"  ! Absolute pathname
\end{example}
\bmad will read the called file until a \vn{return} or \vn{end_file}
statement is encountered or the end of the file is reached.

For filenames that are relative, the called file will be searched for in
two different locations:
\begin{example}
  1) Relative to the directory of the calling file.
  2) Relative to the current directory.
\end{example}
The first instance where a file is found is used.
Thus, in the above example, the first call will search for:
\begin{example}
  2) ../layout/my_layout.bmad  (relative to the calling file directory)
  1) ../layout/my_layout.bmad  (relative to the current directory)
\end{example}

An XSIF (\sref{s:lattice.file.formats}) lattice file may be called
from within an \bmad lattice file by prepending \vn{"xsif::"} to the
file name. Example:
\begin{example}
  call, filename = "xsif::my_lattice.xsif"
\end{example}
This statement must be the first statement in the \bmad lattice file
except for any \vn{no_digested} or \vn{parser_debug} statements. The
XSIF lattice file must define a complete lattice and cannot contain
any \bmad specific statements. The call to the XSIF file automatically
expands the lattice (\sref{s:expand}) and any additional statements in
the \bmad lattice file operate on the expanded lattice.

%--------------------------------------------------------------------------
\section{Return and End_File statements}
\index{return statement|hyperbf}
\index{end_file statement|hyperbf}

\vn{Return} and \vn{end_file} have identical effect and tell \bmad to
ignore anything beyond the \vn{return} or \vn{end_file} statement in
the file.

%--------------------------------------------------------------------------
\section{Beginning Statement}
\label{s:beginning}
\index{beginning statement|hyperbf}

\index{beta_a}
\index{alpha_a}
\index{phi_a}
\index{eta_x}
\index{etap_x}
\index{beta_b}
\index{alpha_b}
\index{phi_b}
\index{eta_y}
\index{etap_y}
\index{cmat_ij}
\index{e_tot}
\index{p0c}
For non--circular lattices the \vn{beginning} statement can be used to
set the Twiss parameters and beam energy at the beginning of the lat
\begin{example}
  beginning[beta_a]  = <Real>  ! "a" mode beta
  beginning[alpha_a] = <Real>  ! "a" mode alpha
  beginning[phi_a]   = <Real>  ! "a" mode phase
  beginning[eta_x]   = <Real>  ! x-axis dispersion
  beginning[etap_x]  = <Real>  ! x-axis dispersion derivative.
  beginning[beta_b]  = <Real>  ! "b" mode beta
  beginning[alpha_b] = <Real>  ! "b" mode alpha
  beginning[phi_b]   = <Real>  ! "b" mode phase
  beginning[eta_y]   = <Real>  ! y-axis dispersion
  beginning[etap_y]  = <Real>  ! y-axis dispersion derivative.
  beginning[cmat_ij] = <Real>  ! C coupling matrix. i, j = {``1'', or ``2''} 
  beginning[s]       = <Real>  ! Longitudinal starting position.
  beginning[e_tot]   = <Real>  ! Reference total energy in eV.
  beginning[p0c]     = <Real>  ! Reference momentum in eV.
\end{example}
\index{e_tot}
The \vn{gamma_a}, \vn{gamma_b}, and \vn{gamma_c} (the coupling gamma
factor) will be kept consistent with the values set. If not set the
default values are all zero.  \vn{beginning[e_tot]} and
\vn{parameter[e_tot]} are equivalent and one or the other may be
set but not both. Similarly, \vn{beginning[p0c]} and
\vn{parameter[p0c]} are equivalent.

\index{x_position}
\index{y_position}
\index{z_position}
\index{theta_position}
\index{phi_position}
\index{psi_position}
For any lattice the \vn{beginning} statement can be used to set the starting floor position 
(see~\ref{s:global}). The syntax is
\begin{example}
  beginning[x_position]     = <Real>  ! X position
  beginning[y_position]     = <Real>  ! Y position
  beginning[z_position]     = <Real>  ! Z position
  beginning[theta_position] = <Real>  ! Angle on floor
  beginning[phi_position]   = <Real>  ! Angle of attack
  beginning[psi_position]   = <Real>  ! Roll angle
\end{example}

%----------------------------------------------------------------------------
\section{Expand_lattice Statement}
\label{s:expand}
\index{lattice!expansion|hyperbf}
\index{expand_lattice}

At some point in parsing a lattice file, the ordered sequence of
elements that form a lattice must be constructed. This process is called
\vn{lattice expansion} since the element sequence can be built up from
sub--sequences (\sref{c:sequence}). Normally lattice expansion happens
automatically at the end of the parsing of the lattice file but an
explicit \vn{expand_lattice} statement in a lattice file will cause
immediate expansion. The reason why this can be important is that there
are restrictions, on some types of operations which must come either
before or after lattice expansion:
\begin{Itemize}
\item 
\index{Intrinsic functions!ran}
\index{Intrinsic functions!ran_gauss}
The \vn{ran} and \rn{ran_gauss} functions, when used with elements
that show up multiple times in a lattice, generally need to be used
after lattice expansion. See \sref{s:functions}.
\item 
Some dependent variables may be set as if they are independent
variables but only if done before lattice expansion. See \sref{s:depend}.
\index{multipass}
\item 
Setting the \vn{dphi0} attribute for an 
\vn{Lcavity} or \vn{RFcavity} multipass
slave may only be done after lattice expansion (\sref{s:multipass}).
\item
\index{tags for Lines and Lists}
Setting individual element attributes for tagged elements can only be done
after lattice expansion (\sref{s:tag}).
\end{Itemize}

%--------------------------------------------------------------------------
\section{Debugging Statements}
\index{parser_debug statement}
\index{no_digested statement}
\index{lattice files!parser debugging}

There are two statements, \vn{parser_debug} and \vn{no_digested},
which can help in debugging the \bmad lattice parser
itself.  That is, these statements are generally only used by programmers.

The \vn{no_digested} statement if present, will prevent \bmad from 
creating a digested file. 

The \vn{parser_debug} statement will cause information about the
lattice to be printed out at the terminal. It is recommended that this
statement be used with small test lattices since it can generate a lot
of output. The syntax is
\begin{example}
  parser_debug <switches>
\end{example}
Valid \vn{<switches>} are
\begin{example}
  beam_start          ! Print the beam_start information.
  ele <n1> <n2> ...   ! Print full info on selected elements.
  lattice             ! Print a list of lattice element information.
  lord                ! Print full information on all lord elements.
  seq                 ! Print sequence information.
  slave               ! Print full information on all slave elements.
  var                 ! Print variable information.
\end{example}
Here $<n1>$, $<n2>$, etc. are the index of the selected elements in
the lattice.  Example
\begin{example}
  parser_debug var lat ele 34 78
\end{example}




