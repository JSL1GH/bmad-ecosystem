\chapter{Miscellaneous Programming}

{\bf NOTE: THIS CHAPTER IS UNDER CONSTRUCTION!}

%-----------------------------------------------------------------------------
\section{Custom Elements}
\label{s:custom.ele}
\index{twiss parameters!calculation with custom elements}
\index{custom}

\index{custom}
\index[routine]{radiation_integrals}\index[routine]{em_field}
\index[routine]{make.mat6}\index[routine]{track1}
Routines to handle \vn{custom} elements (\sref{s:custom}) must be supplied
by the creator of the elements.
There are potentially four routines that must be written to implement a custom 
element:
\begin{example}
   \Hyperref{r:radiation.integrals.custom}{radiation_integrals_custom}
   \Hyperref{r:em.field.custom}{em_field_custom}
   \Hyperref{r:make.mat6.custom}{make_mat6_custom}
   \Hyperref{r:track1.custom}{track1_custom}
\end{example}
[Use \vn{getf} for more details about the argument lists for these
routines.]  The \bmad library has dummy routines of the same name to
keep the linker happy when custom routines are not implemented. These
dummy routines, if called, will print an error message and stop the
program. The custom routines are called by their corresponding
regular routines. By ``regular'' routine it is meant the routine
without the ``\vn{_custom}'' suffix. For example, \vn{radiation_integrals}
will call \vn{radiation_integrals_custom}.
Thus if a
program using the custom code does not call a particular
regular routine, the program does not have to implement the 
corresponding custom routine.

   \Hyperref{r:track1.bunch.custom}{track1_bunch_custom}

%-----------------------------------------------------------------------------
\section{Physical Constants}
\label{s:physical.constants}

\index{constants}
Common physical constants that can be used in any expression
are defined in the file
\begin{example}
 sim_utils/interfaces/physical_constants.f90
\end{example}
This includes the constants given in Section~\sref{s:constants} along with
\begin{example}
  mu_0_vac           ! Permeability of free space
  eps_0_vac          ! Permittivity of free space
  g_factor_electron  ! Electron anomalous gyro-magnetic moment
  g_factor_proton    ! Proton anomalous gyro-magnetic moment
\end{example}

%-----------------------------------------------------------------------------
\section{Global Coordinates and S-positions}
\label{s:global.coords}

\index{global coordinates}
\index{s-positions}

%-----------------------------------------------------------------------------
\section{Common Structures}
\label{s:common.struct}

\index{bmad_com}
\index{bmad_status}

There are two common structures used by Bmad for communication between
routines. These are \vn{bmad_com} which is a \vn{bmad_common_struct}
structure and \vn{bmad_status} which is a \vn{bmad_status_struct}
structure.


\index{status}\index{ok}
\index{type_out}\index{sub_type_out}
\index{exit_on_error}
The \vn{bmad_status_struct} structure is:
\begin{example}
type bmad_status_struct
  integer :: status         = ok\$     ! Computation status 
  logical :: ok             = .true.   ! Error flag
  logical :: type_out       = .true.   ! Print error messages?
  logical :: sub_type_out   = .true.   ! 
  logical :: exit_on_error  = .true.   ! Exit program on error?
end type
\end{example}




