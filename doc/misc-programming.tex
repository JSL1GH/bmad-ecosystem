\chapter{Miscellaneous Programming}

%-----------------------------------------------------------------------------
\section{Common Structures}
\label{s:common.struct}

\index{Bmad_com}
\index{Bmad_status}

{\bf NOTE: THIS CHAPTER IS UNDER CONSTRUCTION!}

There are two common structures used by Bmad for communication between
routines. These are \vn{bmad_com} which is a \vn{bmad_common_struct}
structure and \vn{bmad_status} which is a \vn{bmad_status_struct}
structure.

\index{Max_aperture_limit}\index{D_orb(6)}
\index{Grad_loss_sr_wake}\index{Default_ds_step}
\index{Rel_tolerance}\index{Abs_tolerance}
\index{Taylor_order}\index{Default_integ_order}
\index{Canonical_coords}\index{Use_liar_lcavity}
\index{Sr_wakes_on}\index{Lr_wakes_on}
\index{Mat6_track_symmetric}\index{Auto_bookkeeper}
\index{Trans_space_charge_on}\index{Coherent_synch_rad_on}
\index{Spin_tracking_on}\index{Radiation_damping_on}
\index{Radiation_fluctuations_on}\index{Compute_ref_energy}
The \vn{bmad_common_struct} structure is:
\begin{example}
  type bmad_common_struct
    real(rp) :: max_aperture_limit = 1e3       ! Max Aperture.
    real(rp) :: d_orb(6)           = 1e-5      ! for the make_mat6_tracking routine.
    real(rp) :: grad_loss_sr_wake  = 0         ! Internal var for LCavities.
    real(rp) :: default_ds_step    = 0.2       ! Integration step size.  
    real(rp) :: rel_tolerance = 1e-5
    real(rp) :: abs_tolerance = 1e-8
    integer :: taylor_order = 3                ! 3rd order is default
    integer :: default_integ_order = 2         ! PTC integration order
    logical :: canonical_coords = .true.       ! Use (x, px) [not (x, x')]
    logical :: use_liar_lcavity = .false.      ! Liar like tracking?
    logical :: sr_wakes_on = .true.            ! Short range wake fields?
    logical :: lr_wakes_on = .true.            ! Long range wake fields
    logical :: mat6_track_symmetric = .true.   ! symmetric offsets
    logical :: auto_bookkeeper = .true.        ! Automatic bookkeeping?
    logical :: trans_space_charge_on = .false. ! Space charge switch
    logical :: coherent_synch_rad_on = .false. ! csr 
    logical :: spin_tracking_on = .false.      ! spin tracking?
    logical :: radiation_damping_on = .false.       ! Damping toggle.
    logical :: radiation_fluctuations_on = .false.  ! Fluctuations toggle.
    logical :: compute_ref_energy = .true.          ! Enable recomputation?
  end type
\end{example}


\index{Status}\index{OK}
\index{type_out}\index{sub_type_out}
\index{exit_on_error}
The \vn{bmad_status_struct} structure is:
\begin{example}
type bmad_status_struct
  integer :: status         = ok\$     ! Computation status 
  logical :: ok             = .true.   ! Error flag
  logical :: type_out       = .true.   ! Print error messages?
  logical :: sub_type_out   = .true.   ! 
  logical :: exit_on_error  = .true.   ! Exit program on error?
end type
\end{example}




