\chapter{Tao Line Mode Commands}
\label{c:command}

\tao has two \vn{modes} for entering commands. In \vn{Line Mode},
described in this chapter, \tao waits until the \vn{return} key is
depressed to execute a command. That is, a command consists of a
single line of input. Conversely, \vn{Single Mode}, which is described
in Chapter~\sref{c:single}, interprets each keystroke as a
command. Single Mode is useful for quickly varying parameters to see
how they affect a lattice but the number of commands in Single Mode is
limited.

Commands are case sensitive. The list of commands is shown in
Table~\ref{t:commands}.\index{Commands!Command List} Multiple commands
may be entered on one line using the ``;'' character as a separator.

%% command_table -----------------------------------------------------

\begin{table}[h]
\centering {\tt
\begin{tabular}{|l|l||l|l|} \hline
  {\it Command} & {\it Section}  & {\it Command} & {\it Section}  \\ \hline
  alias      & \sref{s:alias}    & read         & \sref{s:read}     \\ \hline
  call       & \sref{s:call}     & restore      & \sref{s:restore}  \\ \hline 
  change     & \sref{s:change}   & reinitialize & \sref{s:reinit}   \\ \hline 
  clip       & \sref{s:clip}     & run          & \sref{s:run}      \\ \hline 
  derivative & \sref{s:deriv}    & scale        & \sref{s:scale}    \\ \hline 
  end-file   & \sref{s:end-file} & set          & \sref{s:set}      \\ \hline  
  exit       & \sref{s:exit}     & show         & \sref{s:show}     \\ \hline 
  flatten    & \sref{s:flatten}  & single-mode  & \sref{s:sing}     \\ \hline 
  help       & \sref{s:help}     & spawn        & \sref{s:spawn}    \\ \hline 
  history    & \sref{s:history}  & use          & \sref{s:use}      \\ \hline 
  misalign   & \sref{s:misalign} & veto         & \sref{s:veto}     \\ \hline 
  output     & \sref{s:output}   & view         & \sref{s:view}     \\ \hline 
  place      & \sref{s:place}    & x-axis       & \sref{s:x-axis}   \\ \hline 
  plot       & \sref{s:plot}     & x-scale      & \sref{s:x-scale}  \\ \hline 
  quit       & \sref{s:quit}     & xy-scale     & \sref{s:xy-scale} \\ \hline
\end{tabular}}
\caption{Table of \tao commands.}
\label{t:commands}
\end{table}

%% Marker: "help" will not display anything after this  -----------

\index{Arithmetic expressions} 
The \tao command prompt parser can handle arithmetic expressions. 
Arithmetic expressions can be used in a place where a real value is required.
The standard operators are defined: \hfil\break
\hspace*{0.15in}
\begin{tabular}{ll}
  $a + b$           & Addition        \\
  $a - b$           & Subtraction     \\
  $a \, \ast \, b$  & Multiplication  \\
  $a \; / \; b$     & Division        \\
  $a \, \land \, b$ & Exponentiation  \\
\end{tabular} \newline
The following intrinsic functions are also recognized: \hfil\break
\index{Intrinsic functions}
\hspace*{0.15in}
\begin{tabular}{ll}
  \vn{sqrt}(x)      & Square Root    \\
  \vn{log}(x)       & Logarithm      \\
  \vn{exp}(x)       & Exponential    \\
  \vn{sin}(x)       & Sine           \\
  \vn{cos}(x)       & Cosine         \\
  \vn{tan}(x)       & Tangent        \\
  \vn{asin}(x)      & Arc sine       \\
  \vn{acos}(x)      & Arc cosine     \\
  \vn{atan}(x)      & Arc Tangent    \\
  \vn{abs}(x)       & Absolute Value \\
  \vn{ran}()        & Random number between 0 and 1 \\
  \vn{ran_gauss}()  & Gaussian distributed random number with unit RMS \\
\end{tabular} \newline
Both \vn{ran} and \vn{ran_gauss} use a seeded random number generator. 
Setting the seed is described in Section~\sref{s:globals}.

For a description of \vn{single mode} commands see
Chapter~\ref{c:single}. To put \tao into \vn{single mode} use the
\vn{single_mode} command. 

\vfil
\break

%% alias --------------------------------------------------------------
\section{alias}\index{Commands!alias}
\label{s:alias}

Format: 
\begin{example}
  alias \{<alias_name> <string>\}
\end{example}

\vskip 0.2in

\vn{Alias} is like Unix aliases and allows the defining of alias
commands. Using the \vn{alias} command without any arguments results
in a printout of the aliases that have been defined. When using an
alias up to 9 arguments may be substituted in the \vn{<string>}. The
i\Th argument is substituted in place of the sub-string ``[[i]]''.
arguments that do not have a corresponding ``[[i]]'' are placed at the end
of \vn{<string>}

Examples:
\begin{example}
    alias xyzzy plot [[1]] model  ! Define xyzzy
    alias                         ! Show all aliases
    xyzzy top                     ! Use an alias
    plot top model                ! Equivalent to "xyzzy top"
    xyzzy top abc                 ! Equivalent to "plot top model abc"
\end{example}
In the above example ``xyzzy'' is the alias for the string ``plot [[1]]
model''.  When the command xyzzy is used ``top'' is substituted
for ``[[1]]'' in the string.

%% call --------------------------------------------------------------
\section{call}\index{Commands!call}
\label{s:call}

Format: 
\begin{example}
  call <filename> \{<arg_list>\}  \Strut
\end{example}

\vskip 0.2in 
\vn{call} opens a command file and executes the commands
in it.  \tao first looks in the current directory for the file. If not
found \tao will look in the directory pointed to by the
\vn{TAO_COMMAND_DIR} directory.  Up to 9 arguments may be passed to
the command file. The i\Th argument is substituted in place of the
string ``[[i]]'' in the file. Nesting of command files (command files
calling other command files) is allowed. There is no limit to the
number of nested files.

Do loops are allowed with the following syntax:
\begin{example}
  do <var> <begin> <end> <step> 
    ...
    tao command [[<var>]]
    ...
  enddo
\end{example}
\vn{<var>} can be any character string up to 10 characters long.
The \vn{<var>} can be used as a variable in the loop body but must be
bracketed.  The step size can be any integer positive or negative but not zero.
Nested loops are allowed. Command files can be called within do loops.

Examples:
\begin{example}
    call my_cmd_file abc def 
\end{example}
In the above example the argument ``abc'' is substituted for any
``[[1]]'' appearing the file and ``def'' is substituted for any
``[[2]]''.
\Newline

\begin{example}
  do i 1 100
    call set_quad_misalignment [[i]] ! command file to misalign quadrupoles
    zero_quad 1e-5*2^([[i]]-1) ! Some user supplied command to zero quad number [[i]]
  enddo
\end{example}

%% change --------------------------------------------------------------
\section{change}\index{Commands!change}
\label{s:change}

Format:
\begin{example}
  change ele <name_or_number> <attribute> <number>
  change var <name> <locations> <number>
  change beam_start <coordinate> <number>
\end{example}

\vskip 0.2in 
\vn{change} changes element attribute values or variable
values in the \vn{model} lattice. To set, say, datum values, etc. use
the \vn{set} command.

Generally \vn{<number>} is added to the existing value of the
attribute or variable. That is:
\begin{example}
  final_value = initial_value + <number>
\end{example}
If "@" is prepended to \vn{<number>} then just the value of
\vn{<number>} is used to set the value
\begin{example}
  final_value = <number>
\end{example}
If "d" is prepended to \vn{<number>} then the value relative to the design
value is used:
\begin{example}
  final_value = design_value + <number>
\end{example}

For linear lattices, \vn{change beam_start <coordinate> <number>} 
can be use to vary the starting coordinates where \vn{<coordinate>} is one of: 
\begin{example}
  (x, p_x, y, p_y, z, p_z)
\end{example}
For circular lattices only the \vn{p_z} component is applicable. 
Also for linear lattices, \vn{change ele beginning <twiss>} can be used to
vary the starting Twiss parameters where \vn{<twiss>} is one of:  
\begin{example}
  beta_a, beta_b, alpha_a, alpha_b 
  eta_a, eta_b,etap_a, etap_b    
\end{example}

Examples:
\begin{example}
  change ele 124 x_offset  0.1     ! Offset element #124 by 0.1
  change ele q02w k1 d 1.2e-2      ! set the k1 strength of q02w relative to the design
  change var steering[34:36] @1e-3 ! set the steering strength #34-36 to 0.001
  change var steering[*] @0.0      ! set all steering strengths to 0.0
  change beam_start x @0.001       ! set beginning x position to 1 mm
\end{example}


%% clip --------------------------------------------------------------
\section{clip}\index{Commands!clip}
\label{s:clip}

Format:
\begin{example}
  clip \{<where> <limit1> <limit2>\}
\end{example}

\vskip 0.2in 
\vn{clip} vetoes data points for optimizing. If points are vetoed and
either measured or reference data is being plotted then the points
clipped will no longer be plotted. The points vetoed are those points
whose $y$ values are outside a certain range defined by \vn{<limit1>}
\vn{<limit2>}. If neither \vn{<limit1>} nor \vn{<limit2>} is present
then the clip range is taken to be outside the graph minimum and
maximum $y$--axis values. If only \vn{<limit1>} is present then the
clip range is outside the range from -\vn{<limit1>} to
+\vn{<limit1>}. If both are present than the range is from
\vn{<limit1>} to \vn{<limit2>}.  The graphs that are clipped is
determined by the \vn{<where>} switch.  If \vn{<where>} is not present
all graphs are scaled.

Examples
\begin{example}
  clip top.x -3  7  ! clip the x graph in the top region
  clip bottom       ! clip the graphs in the bottom region
\end{example}

%% end-file --------------------------------------------------------------
\section{end-file}
\label{s:end-file}
\index{Commands!end-file}

The \vn{end-file} is used in command files (\sref{s:call}) to signal
the end of the file. Everything an \vn{end-file} command is
ignored. An \vn{end-file} command entered at the command line will
simply generate an error message.

%% exit --------------------------------------------------------------
\section{exit}\index{Commands!exit}
\label{s:exit}

Format:
\begin{example}
  exit
\end{example}

\vskip 0.2in
\vn{Exit} exits the program. Same as \vn{Quit}.

%% derivative --------------------------------------------------------------
\section{derivative}\index{Commands!derivative}
\label{s:deriv}

Format:
\begin{example}
  derivative
\end{example}

\vskip 0.2in 
\vn{Derivative} calculates the \vn{dModel_Data/dVar} derivative
matrix needed for the \vn{lm} optimizer.

%% flatten --------------------------------------------------------------
\section{flatten}\index{Commands!flatten}
\label{s:flatten}

Format:
\begin{example}
  flatten <optimizer>
\end{example}

\vskip 0.2in
\vn{Flatten} runs the optimizer to minimize the merit function. This is the 
same as \vn{run}. See the \vn{run} command for more details.

%% help --------------------------------------------------------------
\section{help}\index{Commands!help}
\label{s:help}

Format:
\begin{example}
  help <command>
\end{example}

\vskip 0.2in 
\vn{Help} gives help on \tao commands. The environmental
variable \vn{TAO_DIR} must be defined so \tao can find any help files.

Examples:
\begin{example}
  help run   ! Gives help on the run command
\end{example}

%% history --------------------------------------------------------------
\section{history}\index{Commands!history}
\label{s:history}

Format:
\begin{example}
  history           ! Print the command history.
  history <number>  ! Re-execute a command by number.
  history <string>  ! Re-execute last command that begins with <string>.
\end{example}

\vskip 0.2in
Every \tao command entered is recorded in a ``history stack'' and
these commands can be viewed and reinvoked as needed. 

Examples
\begin{example}
  history 34   ! Re-execute command number 34.
  history set  ! Re-execute last set command.  
\end{example}

%% misalign --------------------------------------------------------------
\section{misalign}\index{Command!misalign}
\label{s:misalign}

Format:
\begin{example}
   misalign <wrt> <ele_type> <locations> <ele_attrib> <misalign_value>
\end{example}

\vskip 0.2in
Misaligns a set of elements of type \vn{<ele_type>} at lattice
locations \vn{<locations>}.  The element attribute \vn{<ele_attrib>}
is ``misaligned'' by the rms value \vn{<misalign_value>} with respect
to the setting of \vn{<wrt>}. Any element attribute can be misaligned
provided the attribute is free to vary.

If \vn{<ele_type>} begins with "*@" then choose all universes. If
\vn{<ele_type>} begin with "n@" then choose universe n. Otherwise the
viewed universe is used.

\vn{<locations>} is a range of lattice indices in the form
\vn{nnn:mmm} or the work \vn{ALL}. Only elements of type
\vn{<ele_type>} will be misaligned within the range.

If \vn{<misalign_value>} is prepended by 'x' then the misalignment value will be
a relative misalignment with respect to the \vn{<wrt>} value. Otherwise, it's an 
absolute rms value about the \vn{<wrt>} value.

In the special case where sbend strengths are misaligned then use
\vn{<ele_attrib> = g_err}. However, if a relative error is specified it will be 
relative to 'g'.

The possible values of \vn{<wrt>} are:
\begin{example}
  wrt_model          ! Misalign about the current model value
  wrt_design         ! Misalign about the design value
  wrt_survey         ! Misalign about the zero value
\end{example}

Examples
\begin{example}
   ! The following will misalign all quadrupole vertical positions in the viewed
   ! universe within the lattice element range 100:250 with respect to the zero 
   ! value by 300 microns
  misalign wrt_survey quadrupole 100:250 y_offset 300e-6
   ! The following will misalign all quadrupole strengths in all universes for
   ! the entire lattice with respect to the design value by 1%.
  misalign wrt_design *@quadrupole ALL k1 x0.01
\end{example}

%% output --------------------------------------------------------------
\section{output}\index{Commands!output}
\label{s:output}

Format:
\begin{example}
  output bmad_lattice \{<file_name>\}       ! Write a Bmad lattice file of the model
  output beam \{-ascii\} \{-at <element_name_or_index>\} \{<file_name>\} 
                                          ! Write beam distribution data.
  output curve <curve_name> \{<file_name>\} ! Write the curve data
  output derivative_matrix \{file_name\}    ! Write the \vn{dModel_Data/dVar} matrix.
  output digested \{<file_name>\}     ! Write a digested Bmad lattice file of the model.
  output gif \{<file_name>\}          ! create a gif file of the plot window.
  output hard                       ! Print the plot window to a printer.
  output hard-l                     ! Like "hard" except use landscape orientation. 
  output mad_lattice \{<file_name>\}  ! Write a Mad lattice file of the model
  output ps \{<file_name>\}           ! Create a postscript file of the plot window.
  output ps-l \{<file_name>\}         ! Like "ps" except use landscape orientation.
  output var \{<file_name>\}          ! Write a Bmad file of variable values.
\end{example}

\vskip 0.2in 
The \vn{output} command creates various files. If
\vn{<file_name>} is not given then the defaults are:
\begin{example}
  Command                         Default File Name
  ------------------              ------------------
  output bmad_lattice             lat_#.bmad
  output beam                     beam_#.dat
  output curve                    curve
  output derivative_mat           derivative_matrix.dat              
  output digested                 digested8_lat_universe_#.bmad
  output gif                      tao.gif
  output mad_lattice              lat_#.mad
  output ps                       tao.ps
  output var                      global%var_out_file
\end{example}
where \vn{\#} is replaced by the universe number. \vn{output
curve} will produce two or three files: 
\begin{example}
  <file_name>.symbol_dat    ! Symbol coordinates file
  <file_name>.line_dat      ! Curve coords.
  <file_name>.particle_dat  ! Particle data file
\end{example}
The particle data file is only produced if particle
data is associated with the curve.
The curve coordinates are the the set of points that are used to draw the
(possibly smooth) curve through the symbols.

\vn{output beam} will create a file of the particle positions when
beam tracking is being used. If the switch \vn{-at} is present then
only the particle positions at the given element are written. 
Otherwise the positions at all elements will be written. The
\vn{-ascii} switch is for writing text files. The default is to write
with a compressed binary format.  Note: Beam files can be used to
initialize \tao (\sref{s:command_line}). 

Note: PGPLOT does a poor job producing gif files so consider
making a postscript file instead and using a ps to gif converter.

%% place --------------------------------------------------------------
\section{place}\index{Commands!place}
\label{s:place}

Format:
\begin{example}
  place <region> <template>
  place <region> none
\end{example}

\vskip 0.2in 
The \vn{place} command is used to associate a \vn{<template>} plot
with a \vn{<region>} and thus create a visible plot in that region. To
erase a plot from a region use the \vn{none} switch. Notice that by
using multiple \vn{place} commands a \vn{template} can be associated
with more than one region.

Examples:
\begin{example}
  place top orbit  ! place the orbit template in the top region
  place top none   ! erase any plots in the top region
\end{example}

%% plot --------------------------------------------------------------
\section{plot}\index{Commands!plot}
\label{s:plot}

Format:
\begin{example}
  plot <region> <who>
\end{example}

\vskip 0.2in 
The \vn{plot} command is used to determine who is plotted
in the graphs of a given region. Use a ``-'' for baselines. 

Examples:
\begin{example}
  plot bottom model - design       ! Plot model - design in the bottom region
  plot top meas - model + design - ref 
\end{example}

%% quit --------------------------------------------------------------
\section{quit}\index{Commands!quit}
\label{s:quit}

Format:
\begin{example}
  quit
\end{example}

\vskip 0.2in
\vn{Quit} exits the program. Same as \vn{exit}.

%% read --------------------------------------------------------------
\section{read}\index{Commands!read}
\label{s:read}

Format:
\begin{example}
  read lattice <file_name>
\end{example}

\vskip 0.2in 
The \vn{read} command is used to modify the currently
viewed \vn{model} lattice. For example, with the appropriate file,
the \vn{read} command can be used to misalign the lattice
elements. The input file must be in Bmad standard lattice format.

%% restore --------------------------------------------------------------
\section{restore}\index{Commands!restore}
\label{s:restore}

Format:
\begin{example}
  restore data  <data_name> <locations>
  restore var <var_name> <locations>
\end{example}

\vskip 0.2in 
The \vn{restore} command cancels data or variable
vetoes. See also the \vn{use}
and \vn{veto} commands.

Examples:
\begin{example}
  restore data orbit.x[23,34:56]   ! un-veto orbit.x 23 and 34 through 56.
  restore data orbit.x[23,34:56:2] ! un-veto orbit.x 23 and even datums between 34 
                                   !                                          and 56
  restore data *@orbit[34]         ! un-veto orbit data in all universes.
  restore var quad_k1[67]          ! un-veto variable
\end{example}

%% reinitialize -------------------------------------------------------
\section{reinitialize}\index{Commands!reinitialize}
\label{s:reinit}

Format:
\begin{example}
  reinitialize beam
  reinitialize data
  reinitialize tao \{-init <tao_input_file>\} 
                       \{-beam <beam_input_file>\} \{-lat <lattice_file>\}
\end{example}

\vskip 0.2in 
\vn{reinitialize beam} reinitializes the beam at the start of the
lattice.  That is, a new random distribution is generated. This also
reinitializes the model data.

\vn{reinitialize data} forces a recalculation of the model data.
Normally, a recalculation is done automatically when any lattice
parameter is changed so this command is generally only useful for
debugging purposes.

\vn{reinitializes tao} reinitializes \tao. This can be useful to reset
everything to initial conditions or to perform analysis with more than
one initialization file.  See section \sref{s:command_line} for
details on the arguments.  If there are no arguments, the
\vn{reinitialize} command uses the same arguments that were used in
the last \vn{reinitialize} command, or, if this is the first
reinitialization, what was used to start \tao. If there are arguments,
The defaults will be used.  The default \vn{<init_file>} is what was
used with the last reinitialization or, if this is the first
reinitialization, what was used at startup.

Examples:
\begin{example}
  reinit tao                         ! Reinit using previous arguments
  reinit tao -init tao_special.init  ! Reinitializes \tao with the initialization file 
                                     !   tao_special.init
\end{example}


%% run --------------------------------------------------------------
\section{run}\index{Commands!run}
\label{s:run}

Format:
\begin{example}
  run \{<optimizer>\}
\end{example}

\index{de!optimizer}\index{lm!optimizer}
\vskip 0.2in 
The \vn{run} command runs an optimizer. If \vn{<optimizer>} is not
given then the default optimizer is used. To stop the optimizer before
it is finished press the period ``.''  key. If you want the optimizer
to run forever run the optimizer in \vn{single mode}. Valid optimizers
are:
\begin{example}
  lm            ! Levenburg-Marquardt from Numerical Recipes 
  lmdif         ! Levenburg-Marquardt 
  de            ! Differential Evolution
\end{example}

Examples:
\begin{example}
  run 
  run de
\end{example}

%% scale --------------------------------------------------------------
\section{scale}\index{Commands!scale}
\label{s:scale}

Format:
\begin{example}
  scale \{-axis\} \{<where> <value1> <value2>\}
\end{example}

\vskip 0.2in 
\vn{scale} adjusts the vertical scale of graphs. If neither
\vn{<value1>} nor \vn{<value2>} is present then the scale is adjusted
so that all the data points are within the graph region.  If only
\vn{<value1>} is present then the scale is taken to be from
-\vn{<value1>} to +\vn{<value1>}. If both are present than the scale
is from \vn{<value1>} to \vn{<value2>}.  The graphs that are scaled is
determined by the \vn{<where>} switch. If \vn{<where>} is not present
or \vn{<where>} is \vn{all} then all graphs are scaled.

A graph can have a \vn{y2} (left) axis scale that is separate from the \vn{y} (right) 
axis. Normally, the \vn{scale} command will scale both axes.  Scaling of just one of these
axes can be achieved by using the \vn{/axis} switch. Possible values for \vn{/axis} are:
\begin{example}
  -y                 ! Scale only the y axis.
  -y2                ! Scale only the y2 axis.
\end{example}

Examples:
\begin{example}
  scale top.x -3  7  ! Scale the x graph in the top region
  scale -y2 top.x    ! Scale only the y2 axis of the top.x graph.
  scale bottom       ! Scale the graphs in the bottom region
  scale              ! Scale everything
\end{example}


%% set --------------------------------------------------------------
\section{set}\index{Commands!set}
\label{s:set}

Format:
\begin{example}
  set curve <curve> <component> = <value>
  set data <data_name>|<component> = <value>
  set global <component> = <value>
  set graph <graph> <component> = <value>
  set lattice <component> = <value>
  set plot_page <component> = <value1> \{<value2>\}
  set universe <universe> <on/off> <recalculate>
  set var <var_name>|<component> = <value>
\end{example}

\vskip 0.2in 
The \vn{set} command is used to set values for datums,
variables, etc.  For setting element attributes in the \vn{model}
lattice use the \vn{change} command.

To apply a set to all data or variable classes use ``*''
in place of \vn{<data_name>} or \vn{var_name}.

For \vn{set curve}, the \vn{<component>}s that can be set are:
\begin{example}
  ele_ref_name   ! Name of reference element
  ix_ele_ref     ! Index of reference element
  ix_universe    ! Universe index.
  symbol_every   ! Symbol skip number.
\end{example}

For \vn{set data}, the \vn{<component>}s that can be set are:
\begin{example}
  base        ! Base model value
  design      ! Design model value
  meas        ! Measured data value.
  ref         ! Reference data value.
  weight      ! Weight for the merit function.
  exists      ! Valid datum for computations?
  good_meas   ! A valid measurement has been taken?
  good_ref    ! A valid reference measurement has been taken?
  good_opt    ! Good for using in the merit function for optimization?
  good_plot   ! Good for using in a plot?
  good_user   ! This is what is set by the use, veto, and restore commands.
  merit_type  ! How merit contribution is calculated.
\end{example}
Besides a numeric value \vn{<value>} can be any of the above along with:
\begin{example}
  meas        ! Measured data value.
\end{example}
\vskip 0.2in

For \vn{set graph}, the \vn{component}s that can be set are:
\begin{example}
  who(<n>)    = <string>
  who(<n>)    = <string>, <integer>
  clip        = <logical>
  ix_universe = <number>
  margin%x1   = <number>
  margin%x2   = <number>
  margin%y1   = <number>
  margin%y2   = <number>
\end{example}
\vskip 0.2in

For \vn{set global}, the \vn{show global} will give a list of the
\vn{<component>}s that can be set are
\vskip 0.2in

For \vn{set lattice}, the \vn{<component>}s that can be set are:
\begin{example}
  model      ! Model lattice value.
  base       ! Base lattice value
\end{example}
\vn{<value>} can be:
\begin{example}
  model       ! model lattice value.
  base        ! base lattice value.
  design      ! design lattice value
\end{example}
\vskip 0.2in

For \vn{set plot_page}, the \vn{<component>}s that can be set are:
\begin{example}
  title        = <string>          ! Set the plot title text
  subtitle     = <string>          ! Set the subtitle text
  subtitle_loc = <number> <number> ! Set the subtitle location (\%PAGE)
\end{example}
The \vn{subtitle_loc} component can be used to place the subtitle anywhere on
the plot page. This can be useful for referencing a noteworthy part of a graph
data.
\vskip 0.2in

For \vn{set var}, the \vn{<component>}s that can be set are:
\begin{example}
  model       ! Model lattice value.
  base        ! Base model value
  design      ! Design model value
  meas        ! Value at the time of a measurement.
  ref         ! Value at the time of a reference measurement.
  weight      ! Weight for the merit function.
  exists      ! Does this variable actually correspond to something?
  good_var    ! The optimizer can be allowed to vary it
  good_opt    ! Good for using in the merit function for optimization?
  good_plot   ! Good for using in a plot?
  good_user   ! This is what is set by the use, veto, and restore commands.
  step        ! Sets what a "small" variation of the variable is.
  merit_type  ! How merit contribution is calculated.
\end{example}
\vskip 0.2in

\vn{set universe} will turn the specified universe on or off. Turning
a universe off is useful to speed up lattice calculations when this
universe is not being used. Or, if many changes are to be performed to
a universe and there is no need to do any lattice calculations between
commands then turning off all universes will speed things up. To turn off 
the currently viewed universe use the command \vn{set universe 0 off}. 
To turn off all universes use the command \vn{set universe * off}. 
This flag only affects the lattice calculation. 
Issuing \vn{change, use, veto,} etc...  commands to a turned off universe
will still affect the
universe, however any lattice calculations will not be performed until
the universe is turned back on.  To recalculate the turned on lattices
when issuing a \vn{set universe} command then use \vn{set universe
<universe> <on/off> recalc}. Otherwise, no lattice calculation will
be performed until an appropriate command is called afterwards.  If
optimizing while one or more universes are turned off then the
variables associated with that universe will still be included in the
merit function but not the data for that universe. The variables will
still vary in the turned off universe.

Examples:
\begin{example}
  set data *|ref = *|meas               ! Set ref data = measured in current universe.
  set data 2@orbit.x|base = 2@orbit.x|model 
                                        ! Set the base orbit.x in universe 2 to model
  set graph orbit.x who(1) = model      ! Plot the model orbit in the graph
  set graph orbit.x who(2) = design, -1 ! With the previous line: Plot model - design 
  set var quad\_k1 weight = 0.1         ! Set quad\_k1 weights. 
  set lattice *@*|model = *@*|design    ! Reset model to the design in all universes
\end{example}

%% show --------------------------------------------------------------
\section{show}\index{Commands!show}
\label{s:show}

The \vn{show} command has an optional argument to write the results to a file.
The format for this is:
\begin{example}
  show -write <file_name> <rest_of_the_command>
\end{example}

Format:
\begin{example}
  show alias 
  show beam \{<element_index>\}
  show constraints
  show curve <curve_name> \{-symbol\} \{-line\}
  show data \{<data_name>\} 
  show element <name>
  show global
  show graph <graph_name>
  show hom
  show lattice \{-middle\} \{-custom <file_name>\} \{-s\} \{-elements <name>\} \{<location_range>\}
  show optimizer
  show opt_vars
  show particle lost
  show particle <particle_index>
  show plot
  show plot \{<template_plot_name>\}
  show plot \{<plot_region_name>\}
  show taylor <ele_name>
  show top10
  show universe \{universe_number\}
  show variable \{<var_name> <locations>\}
  show variable <universe_number>@
  show -write <file_name> ...
\end{example}

\vskip 0.2in 
\vn{Show} is used to display various information about
the state of \tao. 

\vn{Show -write} writes to a file as well as printing the information
at the terminal. Results are appended to the output file when \vn{show
-write} is used multiple times. If separate files are desired then if
\vn{global%write_file} has a \vn{*} character in it, a three digit
number is substituted for the \vn{*}. The value of the number starts
at \vn{001} and increases by 1 each time \vn{show -write} is used.

\begin{description}
  \item[show alias]
Shows a list of defined aliases. See the \vn{alias} command for more
details.

  \item[show beam]
If \vn{<element_index>} is absent, \vn{show beam} shows parameters 
used with beam tracking including the number of particles in a bunch, etc.
If \vn{<element_index>} is present, \vn{show beam} will show 
beam prameters at the selected element. Also see \vn{show particle}.

  \item[show constraints]
Lists data and variable constraints.

  \item[show curve]
Show information on a particular curve of a particular plot. See
\sref{s:plotting} for the syntax on plot, graph, and curve names.  Use
\vn{show plot} to get a list of plot names. The \vn{-symbol} switch
will additionally print the (x,y) points for the symbol placement and
the \vn{-line} switch will print the (x,y) points used to draw the
``smooth'' curve in between the symbols.

  \item[show data]
Shows data information. If \vn{<data_name>} and \vn{<locations>} are not
present shown is a list of \vn{d2_data} names.

  \item[show element]
This shows information on lattice elements. \vn{name} is in
\vn{Class:Name} syntax as explained in \sref{s:class:name}. If
\vn{<name>} contains a wild card or a class name then a list of
elements that match the name are shown. If no wild--card or class name
is present then information about the element whose name matches
\vn{<name>} is shown. All data types associated with the element
will also be listed. \vn{<name>} is a number $n$ then the $n$\Th
element in the lattice list will be shown.

\vn{show element} does not show the Taylor map associated with an element
even if it has one. To see this map use the \vn{show taylor}
command. Additionally, by default the wiggler terms of a \vn{map_type}
\vn{wiggler} element will not be printed. To change this use the command:
\vn{set global show_ele_wig_terms = T}.

  \item[show global]
Shows information on the global parameter structure (\sref{s:globals}).

  \item[show graph]
Show information on a particular graph of a particular plot. See
\sref{s:plotting} for the syntax on plot, graph, and curve names.
Use \vn{show plot} to get a list of plot names.

  \item[show hom]
Shows long--rang higher order mode information for linac accelerating
cavities.

  \item[show lattice]
Shows Twiss and orbit data for the \vn{model} lattice at the specified
element locations. The default is to show the parameters at the exit
end of the elements. To show the parameters in the middle use the
\vn{-middle} switch.

The locations to show can either be specified using the \vn{-elements}
switch, or by specifying a longitudinal position range with \vn{-s},
or (the default) by specifying a range of element indexes.  The
\vn{-elements} switch is used specify elements using a \vn{class:name}
format (\sref{s:class:name}). For example:
\begin{example}
  show lat -ele marker:bpm*
\end{example}
This will show the parameters at all marker elements whose name begin
with \vn{"bpm"}. 

Alternatively, a range of elements can be specified using the element
index or the element's longitudinal position with a \vn{":"} being
used to separate the index. For example
\begin{example}  
  Show lat  45:76, 101, 106    ! Show element #45 through #76 and 101 and 106.
  show lat -s  23.9:55.3       ! Show elements whose position is between 
                               !   23.9 meters and 55.3 meters .
\end{example}
If neither \vn{-elements} nor a range is given then the entire lattice
will be shown. The \vn{element_list} is optional but if it is present
it must be at the end of the command line.  If it is not present then
the default is to show the entire lattice.

To customize the output use the command \vn{show lattice -custom
<file_name>}. The customization file looks like:
\begin{example}
  &custom_show_list
    column(1) = "index",   "i6",     6 
    column(2) = "x"        "x"       1       ! blank space
    column(3) = "name",    "a",      0
    column(4) = "key",     "a16",   16
    column(5) = "s",       "f10.3", 10
    column(6) = "beta_a",  "f7.2",   7
    column(7) = "1e3 * orbit_x", "f8.3", 8, "Orbit_x| (mm)" 
  /
\end{example}
each \vn{column(1)} has four components. The first component is what
is to be displayed in that column. Algebraic expressions are
permitted. Any element attribute is permitted ("show ele" will show
element attributes or see the Bmad manual). Additionally, the following
are recognized:
\begin{example}
  x                      ! Add spaces
  index                  ! Index number of element.
  name                   ! Name of element.
  key                    ! Type of element (quadrupole, etc.)
  s                      ! Longitudinal position.
  beta_a,  beta_b        ! Twiss beta functions.
  alpha_a, alpha_b       ! Twiss alpha functions.
  phi_a,   phi_b         ! Betatron phase.
  eta_a,   eta_b         ! Dispersion functions.
  etap_a,  etap_b        ! Dispersion derivatives.
  orbit_x, orbit_px      ! Horizontal position and momentum deviation.
  orbit_y, orbit_py      ! Vertical position and momentum deviation.
  orbit_z, orbit_pz      ! Longitudinal position and momentum deviation.
  xmat_11, xmat_12, etc. ! Element transfer matrix.
\end{example}
If an attribute is does not exist for a given element then the
attribute will be assigned a value of zero. For example, \vn{voltage}
for a \vn{quadrupole} is taken to be zero. Also a divide by zero will
give a value of zero.

The second component is the Fortran edit descriptor. The third column
is the total width of the field. Notice that strings (like the element
name) are left justified and numbers are right justified. In the case
of a number followed by a string, there will be no white space in
between. The use of an "x" column can solve this problem. A field width
of 0 for \vn{name} indicates that the field width will be taken to be
one greater then the maximum characters of any element name.

The last component is column title name. This component is optional
and if not present then \tao will choose something appropriate. The
column title can be split into two lines using \vn{"|"} as a separator.
In the example above, The column title corresponding to \vn{"Orbit_x| (mm)"} 
is:
\begin{example}
  Orbit_x
   (mm)
\end{example}

  \item[show optimizer]
Shows information pertinent to optimization: Data and variables used, etc.

  \item[show opt\_vars]
Shows the settings of the variables used in the optimization using the 
Bmad standard lattice input format.

  \item[show particle]
\vn{show particle lost} shows which particles are lost during beam
tracking. \vn{show particle <index>} shows information on the particle
with the given index. Also see \vn{show beam}.

  \item[show plot]
A simple \vn{show plot} displays which templates are being plotted and
in which regions and also all available templates. See
\sref{s:plotting} for the syntax on plot, graph, and curve names. A
\vn{show plot <plot_name>} will display information on a particular
plot.

  \item[show taylor]
Same as \vn{show element} except that the elements taylor map is also printed.

  \item[show top10]
Shows top contributors to the merit function, dMerit/dVariable
derivatives, and Largest changes in variable value.

  \item[show universe]
Shows various parameters associated with a given universe. If no
universe is specified then the current viewed universe is
used. Parameters displayed include tune, chromaticity, radiation
integrals, etc.

  \item[show variable]
Shows variable information. If \vn{<var_name>} \vn{<locations>} is not
present shown is a list of \vn{v1_var} classes. If \vn{<var_name>} is
\vn{*} then the variables will be printed in Bmad lattice format.
To show variables associated with the \vn{n}th universe use
the format: \vn{show var n@}.

\end{description}

Examples:
\begin{example}
  show data orbit             ! Show orbit data.
  show -file orb.dat orbit    ! Write orbit data to the file "orb.dat".
  show curve r2.g1.c3         ! Show the attributes of a curve named "c3" which is 
                              !   in the graph "g1" which is plotted in region "r2".
  show data                   ! lists d2_data arrays.
  show -write data            ! Same as previous except results are also written
                              !   to a file.
  show data orbit.x           ! list all orbit.x data elements
  show data orbit.x[35]       ! Show details for orbit.x element 35
  show data orbit.x[35,86:95] ! list orbit.x elements 35 and 86 through 95
  show data orbit.x[1:100:5]  ! list every fifth orbit.x element between 1 and 100  
  show ele q*                 ! list all elements with names beginning with "q".
  show ele q10w               ! Show a particular lattice element
  show ele 105                ! Show element #105 in the lattice
  show lattice 50:100         ! Show lattice elements with index 50 through 100
  show var *                  ! list variables in Bmad lattice format.
  show var 2@                 ! List all variables that control attributes in universe 2.
\end{example}

%% single-mode --------------------------------------------------------------
\section{single-mode}\index{Commands!single-mode}
\label{s:sing}

Format:
\begin{example}
  single-mode
\end{example}

\vskip 0.2in 
This command puts \tao into \vn{single mode}. 

%% spawn --------------------------------------------------------------
\section{spawn}\index{Commands!spawn}
\label{s:spawn}

Format:
\begin{example}
  spawn <shell_command>
\end{example}

\vskip 0.2in
Use the \vn{spawn} command to pass a command to the command shell.  The users
default shell is used. \vn{spawn} only works in Linux and Unix environments.

Examples:
\begin{example}
  spawn gv quick_plot.ps &      ! view a postscript file with ghostview
                                ! (and return to the TAO prompt)
  spawn tcsh                    ! launch a new tcsh shell 
                                ! (type 'exit' to return to TAO)
\end{example}

%% use --------------------------------------------------------------
\section{use}\index{Commands!use}
\label{s:use}

Format:
\begin{example}
  use data  <data_name>
  use var <var_name>
\end{example}

\vskip 0.2in 
The \vn{use} command un-vetoes data or variables and sets a veto for
the rest of the data. See also the \vn{restore} and \vn{veto}
commands.

Examples:
\begin{example}
  use data orbit.x             ! use orbit.x data in the viewed universe.
  use data *@orbit[34]         ! use element 34 orbit data in all universes.
  use var quad_k1[67]          ! use variable.
  use var quad_k1[30:60:10]    ! use variables 30, 40, 50 and 60.
  use data *                   ! use all data in the viewed universe.
  use data *@*                 ! use all data in all universes.
\end{example}


%% veto --------------------------------------------------------------
\section{veto}\index{Commands!veto}
\label{s:veto}

Format:
\begin{example}
  veto data <data_name> <locations>
  veto var <var_name> <locations>
\end{example}

\vskip 0.2in 
The \vn{veto} command vetoes data or variables. See also the
\vn{restore} and \vn{use} commands.

Examples:
\begin{example}
  veto data orbit.x[23,34:56]  ! veto orbit.x data.
  veto data *@orbit.*[34]      ! veto orbit data in all universes.
  veto var quad_k1[67]         ! veto variable
  veto var quad_k1[30:60:10]   ! veto variables 30, 40, 50 and 60
  veto data *                  ! veto all data
  veto data *[10:20]           ! veto all data from index 10 to 20 (see note)
\end{example}

Note: The command `\cmd{veto data *.*[10:20]}' will veto all d1\_data elements
within the range 10:20 \textit{using the index convention for each d1\_data
structure separately}. This may produce curious results if the
indexes for the d1\_data structures do not all point to the same lattice
elements. 

%% view --------------------------------------------------------------
\section{view}\index{Commands!view}
\label{s:view}

Format:
\begin{example}
  view <number>
\end{example}

\vskip 0.2in 
The \vn{view} command changes which universe data is taken from from
plotting.  This also sets the default universe that commands are
applied to in the absence of a star prefix.

Examples:
\begin{example}
  view 2   ! Make universe #2 the default.
\end{example}

%% x-axis --------------------------------------------------------------
\section{x-Axis}\index{Commands!x-axis}
\label{s:x-axis}

Format:
\begin{example}
  x-axis <where> <axis_type> ! Sets horizontal data type
\end{example}

\vskip 0.2in 
\vn{X-Axis} sets the \vn{plot%x_axis_type}. This determines 
what data is used for the horizontal axis. Possibilities
for \vn{<axis_type>} are:
\begin{example}
  index     -- Use data index
  ele_index -- Use data element index
  s         -- Use longitudinal position.
\end{example}
Note that \vn{index} only makes sense for data that has an index
associated with it. Also, if a data point has more that one element associated
with it \vn{ele_index} will plot the first element index (\vn{ix_ele} not
\vn{ix_ele0}).

Examples:
\begin{example}
  x-axis all s
  x-axis top index
\end{example}

%% x-scale --------------------------------------------------------------
\section{x-Scale}\index{Commands!x-scale}
\label{s:x-scale}

Format:
\begin{example}
  x-scale \{<where>\} \{<bound1>\} \{<bound2>\} ! Sets horizontal axis bounds.
\end{example}

\vskip 0.2in \vn{x-scale} sets the lower and upper bounds for the
horizontal axis.  If both \vn{<bound1>} and \vn{<bound2>} are present
then \vn{<bound1>} is taken to be the lower (left) bound and
\vn{<bound2>} is the upper (right) bound. If only \vn{<bound1>} is
present then the bounds will be from -\vn{<bound1>} to \vn{<bound1>}.
If neither is present then autoscale will be invoked to give the
largest bounds commensurate with the data. If \vn{<where>} is \vn{s}
then the scaling is done only for the plots where the x--axis scale is
the longitudinal s-position.

Example:
\begin{example}
  x-scale                   ! Autoscale all x-axes.
  x-scale all 0 100         ! Scale all x-axes to go from 0 to 100.
\end{example}

%% xy-scale --------------------------------------------------------------
\section{xy-Scale}\index{Commands!xy-scale}
\label{s:xy-scale}

Format:
\begin{example}
  xy-scale \{<where>\} \{<bound1>\} \{<bound2>\} \{force\} 
                                        ! Sets horizontal and vertical axis bounds.
\end{example}

\vskip 0.2in \vn{xy-scale} sets the lower and upper bounds for both
the horizontal vertical axes.  This is just a shortcut for doing an
\vn{x-scale} followed by a \vn{scale}.  If both \vn{<bound1>} and
\vn{<bound2>} are present then \vn{<bound1>} is taken to be the lower
(left) bound and \vn{<bound2>} is the upper (right) bound. If only
\vn{<bound1>} is present then the bounds will be from -\vn{<bound1>}
to \vn{<bound1>}. If neither is present then autoscale will be invoked
to give the largest bounds commensurate with the data.if \vn{force} is
present then the specified ranges will be used and QuickPlot will not
try to find ``nice'' plot scales.

Example:
\begin{example}
  xy-scale            ! Autoscale all axes.
  xy-scale all -1 1   ! Scale all axes to go from -1 to 1.
\end{example}

