\chapter{Tao Line Mode Commands}
\label{c:command}

This chapter gives a description of the commands that \tao knows about
in \vn{line mode}. Commands are case sensitive. The list of commands
is shown in Table~\ref{t:commands}. 

%%  ---------------------------------------------------------------------
Multiple commands may be entered
on one line using the ``|'' character as a separator.


\begin{table}[h]
\centering {\tt
\begin{tabular}{|l|l||l|l|} \hline
  {\it Command} & {\it Section}  & {\it Command} & {\it Section} \\ \hline
  alias      & \ref{s:alias}    &  restore      & \ref{s:restore} \\ \hline
  call       & \ref{s:call}     &  reinitialize & \ref{s:reinit}  \\ \hline
  change     & \ref{s:change}   &  run          & \ref{s:run}     \\ \hline
  clip       & \ref{s:clip}     &  set          & \ref{s:set}     \\ \hline
  derivative & \ref{s:deriv}    &  scale        & \ref{s:scale}   \\ \hline
  exit       & \ref{s:exit}     &               &                 \\ \hline
  flatten    & \ref{s:flatten}  &  show         & \ref{s:show}    \\ \hline
  help       & \ref{s:help}     &  single-mode  & \ref{s:sing}    \\ \hline
  history    & \ref{s:history}  &  use          & \ref{s:use}     \\ \hline
  output     & \ref{s:output}   &  veto         & \ref{s:veto}    \\ \hline
  place      & \ref{s:place}    &  view         & \ref{s:view}    \\ \hline
  plot       & \ref{s:plot}     &  x-axis       & \ref{s:x-axis}  \\ \hline
  quit       & \ref{s:quit}     &  x-scale      & \ref{s:x-scale} \\ \hline
\end{tabular}}
\caption{Table of \bmad\ elements.}
\label{t:commands}
\end{table}

%%Don't display this!!! ---------------------------------------------------------------------

Note: For a description of \vn{single mode} commands see
Chapter~\ref{c:single}. To put \tao into \vn{single mode} use the
\vn{single_mode} command. 

\vfil
\break

%% alias --------------------------------------------------------------
\section{Alias}
\label{s:alias}

Format: 
\begin{example}
  alias \{<alias_name> <string>\}
\end{example}

\vskip 0.2in

\vn{Alias} is like Unix aliases and allows the defining of alias
commands. Using the \vn{alias} command without any arguments results
in a printout of the aliases that have been defined. When using an
alias up to 9 arguments may be substituted in the \vn{<string>}. The
i\Th argument is substituted in place of the sub-string ``[i]''.
arguments that do not have a corresponding ``[i]'' are placed at the end
of \vn{<string>}

Examples:
\begin{example}
    alias xyzzy plot [1] model  ! Define xyzzy
    alias                       ! Show all aliases
    xyzzy top                   ! Use an alias
    plot top model              ! Equivalent to "xyzzy top"
    xyzzy top abc               ! Equivalent to "plot top model abc"
\end{example}
In the above example ``xyzzy'' is the alias for the string ``plot [1]
model''.  When the command xyzzy is used ``top'' is substituted
for ``[1]'' in the string.

%% call --------------------------------------------------------------
\section{Call}
\label{s:call}

Format: 
\begin{example}
  call <filename> \{<arg_list>\}  \Strut
\end{example}

\vskip 0.2in \vn{call} opens a command file and executes the commands
in it.  \tao first looks in the current directory for the file. If not
found \tao will look in the directory pointed to by the
\vn{TAO_COMMAND_DIR} directory.  Up to 9 arguments may be passed to
the command file. The i\Th argument is substituted in place of the
string ``[i]'' in the file. Nesting of command files (command files
calling other command files) is not allowed.

Examples:
\begin{example}
    call my_cmd_file abc def 
\end{example}
In the above example the argument ``abc'' is substituted for any
``[1]'' appearing the file and ``def'' is substituted for any
``[2]''.

%% change --------------------------------------------------------------
\section{Change}
\label{s:change}

Format:
\begin{example}
  change ele <name> <attribute> <number>
  change var <name> <locations> <number>
\end{example}

\vskip 0.2in
\vn{change} changes element attribute values or variable values. Generally
\vn{<number>} is added to the existing value
\begin{example}
  set_value = init_value + <number>
\end{example}
If "@" is prepended to \vn{<number>} then just the value of
\vn{<number>} is used to set the value
\begin{example}
  set_value = <number>
\end{example}
If "d" is prepended to \vn{<number>}  then the value relative to the design
value is used:
\begin{example}
  set_value = design_value + <number>
\end{example}

For \vn{change ele}, six additional
\vn{<components>}s in addition to the element values are:
\begin{example}
  \{x, y, z\}           ! position 
  \{p\_x, p\_y, p\_z\}  ! velocity
\end{example}.
Any orbit dimension can be changed for linear lattices, for circular lattices
only the \vn{p\_z} component is applicable.

Examples:
\begin{example}
  change ele s24e x_offset  0.1  ! Offset element by 0.1
  change ele q02w k1 d1.2e-2     ! set the k1 strength of q02w relative to the design
  change var steering 34:36 @1e-3  ! set the steering strength #34-36 to 0.001
  change var steering all @0.0  ! set all steering strengths to 0.0
  change ele beginning x @0.001 ! set beggining x position to 1 mm
\end{example}


%% clip --------------------------------------------------------------
\section{Clip}
\label{s:clip}

Format:
\begin{example}
  clip \{<where> <limit1> <limit2>\}
\end{example}

\vskip 0.2in 
\vn{clip} vetoes data points for plotting and optimizing. The points
vetoed are those points whose $y$ values are outside a certain range
defined by \vn{<limit1>} \vn{<limit2>}. If neither \vn{<limit1>} nor
\vn{<limit2>} is present then the clip range is taken to be outside
the graph minimum and maximum $y$--axis values. If only \vn{<limit1>}
is present then the clip range is outside the range from
-\vn{<limit1>} to +\vn{<limit1>}. If both are present than the range
is from \vn{<limit1>} to \vn{<limit2>}.  The graphs that are clipped
is determined by the \vn{<where>} switch.  If \vn{<where>} is not
present all graphs are scaled.

Examples
\begin{example}
  clip top:x -3  7  ! clip the x graph in the top region
  clip bottom       ! clip the graphs in the bottom region
\end{example}

%% exit --------------------------------------------------------------
\section{Exit}
\label{s:exit}

Format:
\begin{example}
  exit
\end{example}

\vskip 0.2in
\vn{Exit} exits the program. Same as \vn{Quit}.

%% derivative --------------------------------------------------------------
\section{Derivative}
\label{s:deriv}

Format:
\begin{example}
  derivative
\end{example}

\vskip 0.2in
\vn{Derivative} calculates the \vn{dModel/dVariable} matrix needed for the \vn{lm} optimizer.

%% flatten --------------------------------------------------------------
\section{Flatten}
\label{s:flatten}

Format:
\begin{example}
  flatten <optimizer>
\end{example}

\vskip 0.2in
\vn{Flatten} runs the optimizer to minimize the merit function. This is the 
same as \vn{run}. See the \vn{run} command for more details.

%% help --------------------------------------------------------------
\section{Help}
\label{s:help}

Format:
\begin{example}
  help <command>
\end{example}

\vskip 0.2in 
\vn{Help} gives help on \tao commands. The environmental
variable \vn{TAO_DIR} must be defined so \tao can find any help files.

Examples:
\begin{example}
  help run   ! Gives help on the run command
\end{example}

%% history --------------------------------------------------------------
\section{History}
\label{s:history}

Format:
\begin{example}
  history           ! Print the command history.
  history <number>  ! Reinvoke a command by number.
  history <string>  ! Reinvoke last command that begins with <string>.
\end{example}

\vskip 0.2in
Every \tao command entered is recorded in a ``history stack'' and
these commands can be viewed and reinvoked as needed. 

Examples
\begin{example}
  history 34   ! Reinvoke command number 34.
  history set  ! Reinvoke last set command.  
\end{example}

%% output --------------------------------------------------------------
\section{Output}
\label{s:output}

Format:
\begin{example}
  output hard     ! print the plot window to a printer.
  output ps       ! create a postscript file of the plot window.
  output var      ! Write a Bmad file of variable valuse.
\end{example}

\vskip 0.2in
\vn{Output} creates various files.

%% place --------------------------------------------------------------
\section{Place}
\label{s:place}

Format:
\begin{example}
  place <region> <template>
  place <region> none
\end{example}

\vskip 0.2in 
The \vn{place} command is used to associate a \vn{<template>} plot
with a \vn{<region>} and thus create a visible plot in that region. To
erase a plot from a region use the \vn{none} switch. Notice that by
using multiple \vn{place} commands a \vn{template} can be associated
with more than one region.

Examples:
\begin{example}
  place top orbit  ! place the orbit template in the top region
  place top none   ! erase any plots in the top region
\end{example}

%% plot --------------------------------------------------------------
\section{Plot}
\label{s:plot}

Format:
\begin{example}
  plot <region> <who>
\end{example}

\vskip 0.2in 
The \vn{plot} command is used to determine who is plotted
in the graphs of a given region. Use a ``-'' for baselines. 

Examples:
\begin{example}
  plot bottom model - design       ! Plot model - design in the bottom region
  plot top meas - model + design - ref 
\end{example}

%% quit --------------------------------------------------------------
\section{Quit}
\label{s:quit}

Format:
\begin{example}
  quit
\end{example}

\vskip 0.2in
\vn{Quit} exits the program. Same as \vn{exit}.

%% restore --------------------------------------------------------------
\section{Restore}
\label{s:restore}

Format:
\begin{example}
  restore data  <data_name> <locations>
  restore var <var_name> <locations>
\end{example}

\vskip 0.2in 
The \vn{restore} command cancels data or variable
vetoes. See also the \vn{use}
and \vn{veto} commands.

Examples:
\begin{example}
  restore data orbit:x  23, 34:56   ! unveto orbit:x data.
  restore data orbit:x  23, 34:56:2 ! unveto orbit:x 34 and even datums between
34 and 56
  restore data orbit;* 34           ! unveto orbit data in all universes.
  restore var quad_k1 67            ! unveto variable
\end{example}

%% reinitialize -------------------------------------------------------
\section{Reinitialize}
\label{s:reinit}

Format:
\begin{example}
  reinitialize \{<init_file>\}
\end{example}

\vskip 0.2in Reinitializes \tao. This can be useful to reset everything to
initial conditions or to perform analysis with more than one initialization file.
If \vn{<init_file>} is not given then 
the current initialization file is used. If \vn{init_file} = \vn{default} then
the default initialization file \vn{tao.init} is used.

Examples:
\begin{example}
  reinitialize 
  reinit tao_special.init !reinitializes \tao with the initialization file 
                           \vn{tao_special.init}
\end{example}


%% run --------------------------------------------------------------
\section{Run}
\label{s:run}

Format:
\begin{example}
  run \{<optimizer>\}
\end{example}

\vskip 0.2in The \vn{run} command runs an optimizer. If
\vn{<optimizer>} is not given then the default optimizer is used. To
stop the optimizer before it is finished press the period ``.''
key. If you want the optimizer to run forever run the optimizer in
\vn{single mode}. Valid optimizers are:
\begin{example}
  lm            ! Levenburg-Marquardt
  de            ! Differential Evolution
\end{example}

Examples:
\begin{example}
  run 
  run de
\end{example}

%% set --------------------------------------------------------------
\section{Set}
\label{s:set}

Format:
\begin{example}
  set data <data_name> <component> = <value> \{<locations>\}
  set global <component> = <value>
  set lattice <component> = <value>
  set plot <component> = <value1> \{<value2>\}
  set universe <universe> <on/off>
  set var <var_name> <component> = <value> \{<locations>\}
\end{example}

\vskip 0.2in
To apply a set to all data or variable classes use ``all''
in place of \vn{<data_name>} or \vn{var_name}. \\

For the \vn{set data} version of \vn{set} possible 
\vn{<component>}s that can be set are:
\begin{example}
  weight      ! Weight for the merit function.
  meas        ! Measured data value.
  ref         ! Reference data value.
  good_user   ! Good data from the perspective of the user of the \tao program.
\end{example}
Besides a numeric value \vn{<value>} can be:
\begin{example}
  meas        ! Measured data value.
  ref         ! Reference data value.
  model       ! model lattice value.
  base        ! base lattice value.
  design      ! design lattice value
\end{example}
\vskip 0.2in

For \vn{set var} version of \vn{set} possible 
\vn{<component>}s that can be set are:
\begin{example}
  weight     ! Weight for the merit function.
  step       ! Sets what a "small" variation of the variable is.
  model      ! Model lattice value.
  base       ! Base lattice value
  good_user  ! A Good variable from the perspective of the user of the \tao program
  good_var   ! 
\end{example}
Besides a numeric value \vn{<value>} can be:
\begin{example}
  meas        ! Value when data measurement was made.
  ref         ! Value when reference measurement was made.
  model       ! model lattice value.
  base        ! base lattice value.
  design      ! design lattice value
\end{example}
\vskip 0.2in

For \vn{set lattice} version of \vn{set} possible 
\vn{<component>}s that can be set are:
\begin{example}
  model      ! Model lattice value.
  base       ! Base lattice value
\end{example}
\vn{<value>} can be:
\begin{example}
  model       ! model lattice value.
  base        ! base lattice value.
  design      ! design lattice value
\end{example}
\vskip 0.2in

For \vn{set global} the possible 
\vn{<component>}s that can be set are:
\begin{example}
  opt_with_ref      = T/F      ! Use the reference data with optimization.
  opt_with_base     = T/F      ! Use the base lattice with optimization.
  single_mode       = T/F      ! This only makes sense if set in the init file.
  n_opti_cycles     = <number> ! Number of optimization cycles
  phase_units       = <number> ! Set phase units output
  prompt_string     = <string> ! Prompt string
  var_out_file      = <name>   ! File name of the list of variables in Bmad format. 
  opt_var_out_file  = <name>   ! File name for the optimizer generated file.
  derivative_recalc = T/F      ! Force recalc of derivative matrix before an optimizer run?
\end{example}
\vskip 0.2in

For \vn{set plot} the possible 
\vn{<component>}s that can be set are:
\begin{example}
  title        = <string>          ! Set the plot title text
  subtitle     = <string>          ! Set the subtitle text
  subtitle_loc = <number> <number> ! Set the subtitle location (\%PAGE)
\end{example}
The \vn{subtitle_loc} component can be used to place the subtitle anywhere on
the plot page. This can be useful for referencing a noteworthy part of a graph
data.
\vskip 0.2in

\vn{set universe} will turn the specified universe on or off. Turning a universe
off is useful to speed up lattice calculations when this universe is not being
used. Or, if many changes are to be performed to a universe and there is no need
to do any lattice calculations between command then turing off all universes
will speed things up. Turn off all universe with the command \vn{set universe 0
off}. This flag only affects the lattice calculation. Issueing \vn{change, use,
veto,} etc...
commands to a turned off uinverse will still affect the universe, however any
lattice calculations will not be performed until the universe is turned back on.
If optimizing while one or more universes are turned off then the variables
associated with that universe will still be included in the merit function but
not the data for that universe. The variables will still vary in the turned off
universe.

Examples:
\begin{example}
  set data all ref = meas         ! set all ref data = measured data in current universe.
  set data orbit:x;2 base = model ! set the ref orbit:x data in universe 2 to meas
  set var quad\_k1 weight = 0.1   ! set quad\_k1 weights. 
  set lattice;0 model = design    ! resets the model lattice to the design in all universes
\end{example}

%% scale --------------------------------------------------------------
\section{Scale}
\label{s:scale}

Format:
\begin{example}
  scale \{<where> <value1> <value2>\}
\end{example}

\vskip 0.2in 
\vn{scale} adjusts the vertical scale of graphs. If neither
\vn{<value1>} nor \vn{<value2>} is present then the scale is adjusted
so that all the data points are within the graph region.  If only
\vn{<value1>} is present then the scale is taken to be from
-\vn{<value1>} to +\vn{<value1>}. If both are present than the scale
is from \vn{<value1>} to \vn{<value2>}.  The graphs that are scaled is
determined by the \vn{<where>} switch. If \vn{<where>} is not present
or \vn{<where>} is ``all'' then all graphs are scaled.

Examples:
\begin{example}
  scale top:x -3  7  ! scale the x graph in the top region
  scale bottom       ! scale the graphs in the bottom region
  scale              ! scale everything
\end{example}


%% show --------------------------------------------------------------
\section{Show}
\label{s:show}

Format:
\begin{example}
  show alias                     
  show constraints
  show data \{<data_name> <locations>\} 
  show ele <ele_name>
  show global
  show lattice <locations>
  show optimizer
  show top10
  show var \{<var_name> <locations>\}
  show plots
\end{example}

\vskip 0.2in
\vn{Show} is used to display various information about the state of \tao.
\begin{description}
\item[show alias]
Shows a list of defined aliases. See the \vn{alias} command for more
details.
\item[show constraints]
Lists data and variable constraints.
\item[show data]
Shows data information. If \vn{<data_name>} and \vn{<locations>} are not
present shown is a list of d2\_data names.
\item[show ele]
This shows information on lattice elements. \vn{<ele_name>} can
contain wild--card characters ``\%'' and ``*''. ``\%'' matches to any
single character and ``*'' matches to any number of characters. If
\vn{<ele_name>} contains a wild card then a list of elements that
match the name are shown. If no wild--card is present then information
about the element whose name matches \vn{<ele_name>} is
shown. All data types associated with the element will also be listed.
 \vn{<ele_name>} is a number $n$ then the $n$\Th element in the
lattice list will be shown.
\item[show global]
Shows global information.
\item[show lattice]
Shows Twiss and orbit data for the \vn{model} lattice
at the specified regular element locations. If \vn{<locations>} is not present
then the length of the lattice will be shown.
\item[show optimizer]
Shows information pertinent to optimization: Data and variables used, etc.
\item[show top10]
Shows top contributors to the merit function, dMerit/dVariable
derivatives, and Largest changes in variable value.
\item[show var]
Shows variable information. If \vn{<var_name>} \vn{<locations>} is
not present shown is a list of v1\_var classes.
\item[show plots]
Shows which templates are being plotted and in which regions and also all
available templates.
\end{description}

Examples:
\begin{example}
  show data
  show data orbit
  show data orbit:x           ! list all orbit:x data elements
  show data orbit:x 35        ! show details for orbit:x element 35
  show data orbit:x 35 86:95  ! list orbit:x elements 35 and 86 through 95
  show data orbit:x 1:100:5   ! list every fifth orbit:x element between 1 and
100
  show ele q*                 ! list all elements with names beginning with "q".
  show ele q10w               ! show a particular lattice element
  show ele 105                ! show element #105 in the lattice
  show lattice 50:100         ! show lattice elements 50 to 100
\end{example}

%% single-mode --------------------------------------------------------------
\section{Single-mode}
\label{s:sing}

Format:
\begin{example}
  single-mode
\end{example}

\vskip 0.2in 
This command puts \tao into \vn{single mode}. 

%% use --------------------------------------------------------------
\section{Use}
\label{s:use}

Format:
\begin{example}
  use data  <data_name> <locations>
  use var <var_name> <locations>
\end{example}

\vskip 0.2in 
The \vn{use} command unvetoes data or variables and sets a veto for
the rest of the data. See also the \vn{restore} and \vn{veto}
commands.

Examples:
\begin{example}
  use data orbit:x  23, 34:56  ! use orbit:x data.
  use data orbit;* 34          ! use orbit data in all universes.
  use var quad_k1 67           ! use variable
  use var quad_k1 30:60:10     ! use variables 30, 40, 50 and 60
  use data all                 ! use all data
\end{example}


%% veto --------------------------------------------------------------
\section{Veto}
\label{s:veto}

Format:
\begin{example}
  veto data <data_name> <locations>
  veto var <var_name> <locations>
\end{example}

\vskip 0.2in 
The \vn{veto} command vetoes data or variables. See also the
\vn{restore} and \vn{use} commands.

Examples:
\begin{example}
  veto data orbit:x  23, 34:56 ! veto orbit:x data.
  veto data orbit;* 34         ! veto orbit data in all universes.
  veto var quad_k1 67          ! veto variable
  veto var quad_k1 30:60:10    ! veto variables 30, 40, 50 and 60
  veto data all                ! veto all data
  veto data all 10:20          ! veto all data from index 10 to 20 (see note)
\end{example}

Note: The command `\cmd{veto data all 10:20}' will veto all d1\_data elements
within the range 10:20 \textit{using the index convention for each d1\_data
structure separately}. This may produce curious results if the
indexes for the d1\_data structures do not all point to the same lattice
elements. 

%% view --------------------------------------------------------------
\section{View}
\label{s:view}

Format:
\begin{example}
  view <number>
\end{example}

\vskip 0.2in 
The \vn{view} command changes which universe data is taken from from
plotting.  This also sets the default universe that commands are
applied to in the absence of a star prefix.

Examples:
\begin{example}
  view 2   ! Make universe #2 the default.
\end{example}

%% x-axis --------------------------------------------------------------
\section{X-Axis}
\label{s:x-axis}

Format:
\begin{example}
  x-axis <where> <axis_type> ! Sets horizontal data type
\end{example}

\vskip 0.2in 
\vn{X-Axis} sets what data is used for the horizontal
axis. Possibilities for \vn{<axis_type>} are:
\begin{example}
  index     -- Use data index
  ele_index -- Use data element index
  s         -- Use longitudinal position.
\end{example}
Note that \vn{index} only makes sense for data that has an index
associated with it. Also, if a data point has more that one element associated
with it \vn{ele_index} will plot the first element index (\vn{ix_ele} not
\vn{ix_ele2}).

Examples:
\begin{example}
  x-axis all s
  x-axis top index
\end{example}

%% x-scale --------------------------------------------------------------
\section{X-Scale}
\label{s:x-scale}

Format:
\begin{example}
  x-scale <where> \{<bound1>\} \{<bound2>\}  ! sets horizontal axis bounds.
\end{example}

\vskip 0.2in 
\vn{x-scale} sets the lower and upper bounds for the horizontal axis.
If both \vn{<bound1>} and \vn{<bound2>} are present then \vn{<bound1>}
is taken to be the lower (left) bound and \vn{<bound2>} is the upper
(right) bound. If only \vn{<bound1>} is present then the bounds will
be from -\vn{<bound1>} to \vn{<bound1>}. If neither is present then
autoscale will be invoked to give the largest bounds comensurate with
the data.

Example:
\begin{example}
  x-scale        ! Autoscale axis.
  x-scale 0 100  ! Axis scale to go from 0 to 100.
\end{example}

