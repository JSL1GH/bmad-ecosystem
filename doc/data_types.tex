\chapter{Data types}
\label{c:data_types}

%------------------------------------------------------------------------
\section{How Tao Handles Data}
\index{Data}

As explained in chapter~\ref{c:overview}, \tao has special structures
to hold data to be analyzed. Any lattice or beam parameters that are
needed to be analyzed or plotted must have a data type defined for
it. In general, a data type can be any type of parameter that is not
necessarily measurable in a real world machine. For example, there is
an orbit data type and a BPM data type. The orbit data is the real
x,y,z position of a particle in the lab frame whereas the BPM data is
the x and y reading on a simulated beam position monitor that includes
any offsets, tilts and noise.

\tao includes many different data types already predefined and
these can be classified into three main catagories:
\begin{enumerate}
  \item \textbf{Lattice Parameters} \Newline
    For example lattice twiss parameters, coupling and floor position.
  \item \textbf{Single Particle Properties} \Newline
    For example particle orbit, BPM reading and phase advance.
  \item \textbf{Bunch Properties} \Newline
    For example bunch sigmas, emittance and beam twiss parameters.
\end{enumerate}
For a given data type the method used to calculate the datum can vary
depending on the tracking type. For {\it single} particle tracking all
data is found from the lattice parameters except for the orbit
data. For \textit{particle bunch} or \textit{macroparticle bunch}
tracking some of the datums are found from the particle distribution
using the appropriate \bmad routines. For example, with single
particle tracking the beta function is found from the lattice
transport matrix, however, with particle or macroparticle tracking the
beta function is found from the particle distribution using the
formula
\begin{equation}
  \beta = \frac{<x^{2}>}{\sqrt{<x^{2}> <x'^{2}> - <x x'>^{2}}}.
\end{equation}
The next section will describe how each predefined data type is
calculated.  Custom data types need not fall into one of the above
catagories and can be any real number as calculated in the appropriate
ook routine.

Also associated with a datum are two lattice elements called
\vni{ele} and \vni{ele0}. The \vni{data_types} are divided into two
categories: Those that are \vni{relative} and those that are not.  A
\vni{relative} \vni{data_type} means that the \vni{model} value for that
datum is determined by a difference between elements. For example, for
\vn{phase.x} the \vn{model} value is
\begin{example}
  model_value = \(\phi\sb{x}\)(ele) - \(\phi\sb{x}\)(ele0)
\end{example}
If there is no \vn{ele0} associated with a datum then the model value is
\begin{example}
  model_value = \(\phi\sb{x}\)(ele) - \(\phi\sb{x}\)(0)
\end{example}
where $\phi_x(0)$ is the phase at the 0\Th element (which is always at
0 radians).
\index{Data!Relative}

For datums with \vni{non-relative} \vn{data_types} if there is also an
associated \vni{ele0} element then the \vn{model} value is dependent
upon the \vni{merit_type}. For example, with a \vn{beta.x}
\vn{data_type} the model value is determined by Table~\ref{t:eval2}
where \vn{i} goes from the \vn{ele} index to the \vn{ele0} index.
\begin{table}[ht]
\centering
{\tt
\begin{tabular}{|l|l|l|} \hline
  {\it Merit\_Type}       & {\it Model Value} \\ \hline 
  \vni{min}     & $\min \beta_x(i)$ \\ \hline 
  \vni{max}     & $\min \beta_x(i)$ \\ \hline 
  \vni{abs_min} & $\min |\beta_x(i)|$ \\ \hline 
  \vni{abs_max} & $\min |\beta_x(i)|$ \\ \hline 
  \vni{target}  & {\it Error}   \\ \hline 
\end{tabular}
}
\caption{\vn{Model} evaluation.}
\label{t:eval2}
\end{table}

%------------------------------------------------------------------------
\section{Tao Data Types}\index{Data!Data Types}
\label{s:data_types}

Table~\ref{t:data_types} lists the predefined data types in \tao.
Table~\ref{t:data_calc_method} lists how each data type is calculated depending
on the tracking type. A ``L'' means that the lattice determines the data type.
In \bmad the twiss parameters are calculated about a reference orbit so the
centroid orbit (or particle orbit for single particle tracking) is also used.
A ``B'' means the beam particle distribution determines the data type. A ``X''
means this data type is not available for this tracking type.

\vn{wire} data simulates the measurement of a wire scanner. The angle specified
is the angle of the wire with respect to the horizontal axis. The measurement
then measures the second momment $<uu>$ along an axis which is 90 degrees off of
the wire axis. For example, \vn{wire:90} is a wire scanner oriented in the
vertical direction and measures the second moment of the beam along the
horizontal axis, $<xx>$. The resultant data is not the beam size, but the beam
size squared.

Data types marked \vn{global} do not have any particular elements
associated with them.

\index{Data!Calculation Method}

\begin{table}[ht] 
\centering 
{\tt
\begin{tabular}{|l|l|l|} \hline
  {\it Data\_Type}        & {\it Description}                 &          \\ \hline 
    beta.x, beta.y        & Projected Beta Function           &          \\ \hline 
    beta.a, beta.b        & Normal-Mode Beta Function         &          \\ \hline 
    alpha.x, alpha.y      & Projected Alpha Function          &          \\ \hline 
    alpha.a, alpha.b      & Normal-Mode Alpha Function        &          \\ \hline 
    eta.x, eta.y          & Dispersion                        &          \\ \hline 
    etap.x, etap.y        & Dispersion derivative             &          \\ \hline 
    phase.x, phase.y      & Betatron phase                    & relative \\ \hline 
    phase\_frac\_diff     & Fractional phase difference (x-y) & relative \\ \hline
    orbit.x, orbit.y      & Transverse orbit                  &          \\ \hline 
    orbit.p\_x, orbit.p\_y& Tranverse momenta                 &          \\ \hline 
    orbit.z, orbit.z\_p   & Longitudinal orbit and momenta    &          \\ \hline 
    bpm.x, bpm.y          & Transverse BPM reading            &          \\ \hline 
    wire.<angle>          & Wire Scanner with wire angle <angle>
                                                              &          \\ \hline
    \begin{tabular}{@{}l}     
      spin.polarization, \\ 
      spin.theta, spin.phi 
    \end{tabular} 
                          & Particle spin                     &          \\ \hline 
    \begin{tabular}{@{}l}     
      cbar.11, cbar.12, \\ 
      cbar.21, cbar.22 
    \end{tabular} 
                          & Coupling                         &          \\ \hline 
    \begin{tabular}{@{}l}   
      coupling.11b, coupling.12a, \\ 
      coupling.12b, coupling.22a 
    \end{tabular} 
                          & Coupling                         &          \\ \hline 
    floor.x, floor.y, floor.z
                          & Global (``floor'') position      & relative \\ \hline 
    floor.theta           & Global (``floor'') angle         & relative \\ \hline 
    r.$ij$                & 
                           \begin{tabular}{l}
                             Term in linear transfer map \\
                             $1 \le i,j \le 6$
                           \end{tabular}
                                                             & relative \\ \hline 
    t.$ijk$               & 
                           \begin{tabular}{l}
                             Term in 2\Nd order transfer map \\
                              $1 \le i,j,k \le 6$
                           \end{tabular} 
                                                             & relative \\ \hline 
    tt.$ijklm\ldots$      & 
                           \begin{tabular}{l}
                             Term in n\Th order transfer map \\
                              $1 \le i,j,k,\ldots \le 6$
                           \end{tabular} 
                                                              & relative \\ \hline 
    i5a\_e6, i5b\_e6      & Normalized I5 radiation integral  &          \\ \hline
    s\_position           & longitudinal length constraint    & relative \\ \hline 
    beam\_energy          & Beam energy                       &          \\ \hline
    unstable\_ring        & Nonzero if a ring is unstable     & global   \\ \hline
    \begin{tabular}{@{}l}
      emittance.a  \\
      emittance.b  \\
    \end{tabular}
                          & Emittance for a ring              & global   \\ \hline
    \begin{tabular}{@{}l}
      chrom.a  \\
      chrom.b  \\
    \end{tabular}
                          & Chromaticity for a ring           & global   \\ \hline
    \begin{tabular}{@{}l}  
      norm\_emittance.x \\ 
      norm\_emittance.y \\
      norm\_emittance.z \\
      norm\_emittance.a \\
      norm\_emittance.b \\
    \end{tabular} 
                          & Normalized emittance              &          \\ \hline 
    \begin{tabular}{@{}l}   
      sigma.x, sigma.p\_x \\ 
      sigma.y, sigma.p\_y \\
      sigma.z, sigma.p\_z \\
    \end{tabular} 
                          & Bunch size                        &          \\ \hline 
    \begin{tabular}{@{}l}  
      dpx\_dx \\ 
      dpy\_dy \\
      dpz\_dz \\
      dpa\_da \\
      dpb\_db \\
    \end{tabular} 
                          & <x p\_x> / <x\^2> \& Etc...       &          \\ \hline 
\end{tabular}
} 
\label{t:data_types}
\caption{Predefined Data Types}
\end{table}

\vfill \break
{\vfill}

\index{i5a_e6}\index{i5b_e6}\index{dpx_dx}\index{dpy_dy}
\index{Element!table of data calculation methods}
\begin{table}[ht] 
\centering {
\begin{tabular}{|l|c|c|c|} \hline
\rule{0pt}{80pt} 
\vni{Data_Type}       &
\begin{sideways}\vni{Single}\end{sideways} &
\begin{sideways}\vni{Particle Beam}\end{sideways} &
\begin{sideways}\vni{Macroparticle Beam}\end{sideways} 
\\ \hline
%   data type             & Single & Beam & Macroparticle
    \vni{beta}             &   L    &   B  &   B   \\ \hline
    \vni{alpha}            &   L    &   B  &   B   \\ \hline
    \vni{eta}              &   L    &   B  &   B   \\ \hline
    \vni{etap}             &   L    &   B  &   B   \\ \hline
    \vni{phase}            &   L    &   L  &   L   \\ \hline
    \vni{orbit}            &   B    &   B  &   B   \\ \hline
    \vni{bpm}              &   B    &   B  &   B   \\ \hline
    \vni{wire}             &   X    &   B  &   X   \\ \hline
    \vni{spin}             &   B    &   B  &   X   \\ \hline
    \vni{cbar}             &   L    &   L  &   L   \\ \hline
    \vni{coupling}         &   L    &   L  &   L   \\ \hline
    \vni{floor}            &   L    &   L  &   L   \\ \hline
    \vni{r}                &   L    &   L  &   L   \\ \hline
    \vni{t}                &   L    &   L  &   L   \\ \hline
    \vni{tt}               &   L    &   L  &   L   \\ \hline
    \vn{i5a_e6, i5b_e6}    &   L    &   L  &   L   \\ \hline      
    \vni{s_position}       &   L    &   L  &   L   \\ \hline           
    \vni{beam_energy}      &   L    &   L  &   L   \\ \hline  
    \vni{%beam_energy}     &   L    &   L  &   L   \\ \hline  
    \vni{norm_emittance}   &   L\footnote{Uses the Courant-Snyder Invariant} 
                                    &   B  &   B   \\ \hline
    \vni{bunch_sigma}      &   X    &   B  &   B   \\ \hline
    \vn{dpx_dx,dpy_dy,...} &   X    &   B  &   B   \\ \hline
\end{tabular}
}
\caption{Data\_type Calculation method. L means this data type uses 
lattice parameters, B means this data type uses beam parameters. 
X mean this data is unavailable for this tracking type.}
\label{t:data_calc_method}
\end{table}

\vfill\break

