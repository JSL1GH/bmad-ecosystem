\chapter{Lattice Parameter Statements}

This chapter deals with statements that can be used to set ``global''
parameter values. That is, parameter values that are associated with
the lattice as a whole and not simply associated with a single element.

%-----------------------------------------------------------------------------
\section{Parameter Statement}
\label{s:param}
\index{parameter statement|hyperbf}


\index{lattice}\index{geometry}
\index{taylor_order}\index{e_tot}
\index{p0c}\index{ran_seed}\index{absolute_time_tracking}
\index{n_part}\index{no_end_marker}
\index{auto_scale_field_phase}\index{auto_scale_field_amp}
\index{ptc_exact_model}\index{ptc_exact_misalign}
The \vn{parameter} statement is used to set the \vn{lattice} name and
other variables. If multiple branches are present (\sref{s:branch.def}), these
variables pertain to the \vn{root} branch. The variables that can be
set by \vn{parameter} are
\begin{example}
  parameter[absolute_time_tracking] = <Logical>  ! Absolute time used for RF clock?
  parameter[aperture_limit_on]      = <Logical>  ! Use aperture limits in tracking.
  parameter[e_tot]         = <Real>          ! Reference total Energy. 
                                             !      Default: 1000 * rest_energy.
  parameter[lattice]       = <String>        ! Lattice name 
  parameter[geometry]      = <Switch>        ! Open or closed
  parameter[n_part]        = <Real>          ! Number of particles in a bunch.
  parameter[no_end_marker] = <Logical>       ! Default: False.
  parameter[p0c]           = <Real>          ! Reference momentum.
  parameter[particle]      = <particle_type> ! Reference species: positron, proton, etc.
  parameter[ran_seed]      = <Integer>       ! Random number generator init.
  parameter[auto_scale_field_phase]    = <Logical>  ! Automatic phase scaling.
  parameter[auto_scale_field_amp]      = <Logical>  ! Automatic amplitude scaling.
  parameter[taylor_order]           = <Integer>  ! Default: 3
  parameter[use_ptc_layout]         = <Logical>  ! Construct layout for calculations?
  parameter[ptc_exact_model]        = <Logical>  ! PTC to do "exact" tracking?
  parameter[ptc_exact_misalignment] = <Logical>  ! PTC to "exactly" misalign elements?
  parameter[ptc_max_fringe_order]   = <Integer>  ! Max fringe order. 
                                                 !    Default: 2 => Quadrupole.
  parameter[use_hard_edge_drifts]   = <Logical>
  parameter[custom_attributeN]      = <string>   ! Defining custom attribues (\sref{s:custom.attrib}).
  parameter[rel_tracking_charge]    = <Real>     ! Charge of tracked particles relative 
                                                 !   to reference charge. Default is 1.
\end{example}

\noindent
Examples
\begin{example}
  parameter[lattice]      = "L9A19C501.FD93S_4S_15KG"
  parameter[geometry]     = closed
  parameter[taylor_order] = 5
  parameter[E_tot]        = 5.6e9    ! eV
\end{example}

\index{end element}
The \vn{parameter[no_end_marker]} is use to suppress the automatic inclusion
of a marker named \vn{END} at the end of the lattice (\sref{s:branch.construct}). 

For more information on \vn{parameter[ran_seed]} see \sref{s:functions}.

For more information on defining custom attributes, see \sref{s:custom.attrib}.

Valid \vn{parameter[particle]} switches are:
\index{positron}\index{electron}\index{proton}\index{antiproton}\index{photon}
\begin{example}
  positron  ! default
  electron
  proton
  antiproton
  muon
  antimuon
  photon
\end{example}

\index{e_tot}
\index{e_tot}
\index{lcavity}
\index{patch}
\index{p0c}
The \vn{parameter[e_tot]} and \vn{parameter[p0c]} are the reference
total energy and momentum at the start of the lattice. Each element
in a lattice has an individual reference \vn{e_tot} and \vn{p0c} attributes
which are dependent parameters. The reference energy and momentum will only
change between \vn{LCavity} or \vn{Patch} elements. The starting
reference energy, if not set, will be set to 1000 time the particle
rest energy.  Note: \vn{beginning[e_tot]} and \vn{beginning[p0c]} are
equivalent to \vn{parameter[e_tot]} and \vn{parameter[p0c]}.

\index{beambeam}
\index{n_part}
\index{lcavity}
The \vn{parameter[n_part]} is the number of particle in a bunch.
it is used with \vn{BeamBeam} elements and is used to calculate the
change in energy through an \vn{Lcavity}. See~\sref{s:lcav} for more
details.

\index{aperture_limit_on}
Aperture limits may be set for elements in the lattice
(\sref{s:limit}). Setting \vn{aperture_limit_on} to \vn{False} will
disable all set apertures. \vn{True} is the default.

\index{lattice statement}
The \vn{lattice} name is stored by \bmad for use by a program but it does
not otherwise effect any \bmad routines. 

\noindent
\index{closed}
\index{open}
\index{lcavity!and geometry}
Valid \vn{geometry} switches are
\begin{example}
  closed  ! Default w/o LCavity element present.
  open    ! Default if LCavity elements present.
\end{example}
A machine with a \vn{closed} geometry is something like a storage ring
where the particle beam recirculates through the machine.  A machine
with an \vn{open} geometry is something like a linac.  In this case,
the initial Twiss parameters need to be specified in the lattice
file. If the \vn{geometry} is not specified, \vn{closed} is the
default. The exception is that if there is an \vn{Lcavity} element
present or the reference particle is a photon, \vn{open} will be the
default.

Note: \vn{geometry} used to be called \vn{lattice_type}, \vn{closed}
used to be called \vn{circular_lattice} and \vn{open} used to be
called \vn{linear_lattice}. This old syntax is still accepted in
lattice files.

\index{rel_tracking_charge}
The \vn{rel_tracking_charge} establishes the charge of particles being
tracked relative to the charge of the reference particle. The default
is 1. 

\index{taylor_order}
The Taylor order (\sref{s:taylor.phys}) is set by
\vn{parameter[taylor_order]} and is the maximum order for a Taylor map.
Historically it is possible to set the Taylor order using the syntax
\begin{example}
  taylor_order = <Integer>   ! DO NOT USE THIS SYNTAX
\end{example}
This syntax is obsolete since a typographical error is not easily caught.

\index{auto_scale_field_phase}\index{auto_scale_field_amp}
\index{rfcavity}\index{lcavity}\index{em_field}
The \vn{auto_scale_field_phase} and \vn{auto_scale_field_amp} switches
toggle the automatic scaling of the RF phase and/or amplitude for
\vn{rfcavity}, \vn{lcavity}, and \vn{em_field} elements
(\sref{c:autoscale}).

\index{absolute_time_tracking}\index{lcavity}\index{rfcavity}
The \vn{absolute_time_tracking} switch sets whether the clock for the
\vn{lcavity} and \vn{rfcavity} elements is tied to the reference
particle or to uses the absolute time (\sref{s:rf.time}). A value of
\vn{False} (the default) mandates relative time and a value of
\vn{True} mandates absolute time.

\index{ptc_exact_model}\index{ptc_exact_misalign}
The \vn{ptc_exact_model} and \vn{ptc_exact_misalign} switches affect
tracking using the \vn{PTC} library. See \sref{s:integ} for more
details.

\index{ptc_max_fringe_order}
When using PTC tracking (\sref{s:ptc.intro}), the
\vn{parameter[ptc_max_fringe_order]} determines the maximum order of
the calculated fringe fields. The default is 2 which means that fringe
fields due to a quadrupolar field. These fields are 3\Rd order in the
transverse coordinates.

%-----------------------------------------------------------------------------
\section{Beam_start Statement} \label{s:beam.start}
\index{beam_start statement|hyperbf}

\index{e_gun}
\index{x}\index{px}\index{y}\index{py}\index{z}\index{pz}
\index{emittance_a}\index{emittance_b}\index{emittance_z}
\index{field_x}\index{field_y}\index{phase_x}\index{phase_y}
The \vn{beam_start} statement is used to set the starting coordinates
for particle tracking. If multiple branches are present
(\sref{s:branch.def}), these variables pertain to the \vn{root}
branch.
\begin{example}
  beam_start[x]           = <Real>   ! Horizontal position.
  beam_start[px]          = <Real>   ! Horizontal momentum.
  beam_start[y]           = <Real>   ! Vertical position.
  beam_start[py]          = <Real>   ! Vertical momentum.
  beam_start[z]           = <Real>   ! Longitudinal position.
  beam_start[pz]          = <Real>   ! Momentum deviation. Only used for non-photons
  beam_start[E_photon]    = <Real>   ! Energy (eV). Only used for photons.
  beam_start[emittance_a] = <Real>   ! A-mode emittance
  beam_start[emittance_b] = <Real>   ! B-mode emittance
  beam_start[emittance_z] = <Real>   ! Z-mode emittance
  beam_start[field_x]     = <Real>   ! Photon beam field along x-axis
  beam_start[field_y]     = <Real>   ! Photon beam field along y-axis
  beam_start[phase_x]     = <Real>   ! Photon beam phase along x-axis
  beam_start[phase_y]     = <Real>   ! Photon beam phase along y-axis
  beam_start[t]           = <Real>   ! Absolute time
\end{example}
Normally the absolute time, set by \vn{beam_start[t]}, is a dependent
parameter set by solving \Eq{zbctt} for $t$. The exception is when the
initial velocity is zero. (This can happen if there is an \vn{e_gun}
(\sref{s:e.gun}) element in the lattice). In this case, $z$ must be
zero and $t$ is an independent parameter that can be set.

For photons, \vn{px}, \vn{py}, and \vn{pz} are the normalized velocity components
(Cf.~\Eq{xbybzb}). For photons \vn{pz} is a dependent parameter which will be set
so that \Eq{bbb1} is obayed.

Example
\begin{example}
  beam_start[y] = 2 * beam_start[x]
\end{example}

%-----------------------------------------------------------------------------
\section{Beam Statement}
\index{beam statement|hyperbf}

\index{energy}
\index{particle}
\index{n_part}
\index{MAD!beam statement}
The \vn{beam} statement is provided for compatibility with \mad. The syntax is
\begin{example}
  beam, energy = GeV, pc = GeV, particle = <Switch>, n_part = <Real>
\end{example}
For example
\index{MAD}
\begin{example}
  beam, energy = 5.6  ! Note: GeV to be compatible with \mad
  beam, particle = electron, n_part = 1.6e10
\end{example}
Setting the reference energy using the \vn{energy} attribute is the
same as using \vn{parameter[e_tot]}. Similarly, setting \vn{pc} is
equivalent to setting \vn{parameter[p0c]}. Valid \vn{particle} switches
are the same as \vn{parameter[particle]}.

%--------------------------------------------------------------------------
\section{Beginning and Line Parameter Statements}
\label{s:beginning}
\index{beginning statement|hyperbf}

\index{beta_a}\index{alpha_a}
\index{phi_a}\index{eta_x}
\index{etap_x}\index{beta_b}
\index{alpha_b}\index{phi_b}
\index{eta_y}\index{etap_y}
\index{cmat_ij}\index{e_tot}
\index{p0c}\index{ref_time}
For non--circular lattices, the \vn{beginning} statement can be used to
set the Twiss parameters and beam energy at the beginning of the first lattice branch.
\begin{example}
  beginning[alpha_a]  = <Real>  ! "a" mode alpha
  beginning[alpha_b]  = <Real>  ! "b" mode alpha
  beginning[beta_a]   = <Real>  ! "a" mode beta
  beginning[beta_b]   = <Real>  ! "b" mode beta
  beginning[cmat_ij]  = <Real>  ! C coupling matrix. i, j = {``1'', or ``2''} 
  beginning[e_tot]    = <Real>  ! Reference total energy in eV.
  beginning[eta_x]    = <Real>  ! x-axis dispersion
  beginning[eta_y]    = <Real>  ! y-axis dispersion
  beginning[etap_x]   = <Real>  ! x-axis dispersion derivative.
  beginning[etap_y]   = <Real>  ! y-axis dispersion derivative.
  beginning[p0c]      = <Real>  ! Reference momentum in eV.
  beginning[phi_a]    = <Real>  ! "a" mode phase.
  beginning[phi_b]    = <Real>  ! "b" mode phase.
  beginning[ref_time] = <Real>  ! Starting reference time.
  beginning[s]        = <Real>  ! Longitudinal starting position.
\end{example}
\index{e_tot}
The \vn{gamma_a}, \vn{gamma_b}, and \vn{gamma_c} (the coupling gamma
factor) will be kept consistent with the values set. If not set the
default values are all zero.  \vn{beginning[e_tot]} and
\vn{parameter[e_tot]} are equivalent and one or the other may be
set but not both. Similarly, \vn{beginning[p0c]} and
\vn{parameter[p0c]} are equivalent.

\index{x_position}\index{y_position}\index{z_position}
\index{theta_position}\index{phi_position}\index{psi_position}
For any lattice the \vn{beginning} statement can be used to set the
starting floor position of the first lattice branch
(see~\sref{s:global}). The syntax is
\begin{example}
  beginning[x_position]     = <Real>  ! X position
  beginning[y_position]     = <Real>  ! Y position
  beginning[z_position]     = <Real>  ! Z position
  beginning[theta_position] = <Real>  ! Angle on floor
  beginning[phi_position]   = <Real>  ! Angle of attack
  beginning[psi_position]   = <Real>  ! Roll angle
\end{example}
If the floor position is not specified, the default is to place
beginning element at the origin with all angles set to zero.

\index{root branch}\index{branch}
The \vn{beginning} statement is useful in situations where only parameters for
the first branch need be specified. If this is not the case, the parameters for
any branch can be specified using a statement of the form
\begin{example}
  line_name[parameter] = <Value>
\end{example}
This construct is called a \vn{line parameter} statement
Here \vn{line_name} is the name of a line and \vn{parameter} is the
name of a parameter. The parameters that can be set here are identical
to the parameters that can be set with the \vn{beginning} statement.
Example:
\begin{example}
  x_ray_fork: fork, to_line = x_ray
  x_ray = (...)
  x_ray[E_tot] = 100
\end{example}

Rules:
  \begin{enumerate}
  \item
The floor position of a line can only be set if the line is used for a 
\vn{root} \vn{branch}. 
  \item
Line parameters statements must come after the associated line. This
rule is similar to the rule that element attribute redefinitions must
come after the definition of the element.
 \end{enumerate}
