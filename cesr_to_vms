#!/bin/sh
#---------------------------------------------------------------
# cesr_to_vms - Script to move a specfied release directory from 
#               Unix to VMS
#
# Usage:  cesr_to_vms <release name>
#
# Inputs: (1)  Name of the release to compress and transfer
#
# Author:  M. Palmer  01/09/02
#---------------------------------------------------------------
# One hardcoded line here necessary for subsequent getting of config vars.
UTIL_DIR=`/home/cesrulib/bin/util/getcfg Paths UTIL_DIR`

# Inputs
NAME=$1

if ( [ $# -ne 1 ] ) then
		echo "[cesr_to_vms]:  Incorrect number of parameters specified.  Exiting!"
		exit 1
fi

# Initializations
FULL_NAME=/nfs/acc/libs/VMS_alpha_hp/${NAME}

if ( [ ! -d ${FULL_NAME} ] ) then
  echo "A processed VMS source tree directory with "
  echo "the name ${FULL_NAME} does not exist."
  exit 2
fi

# Get remote path on VMS cluster where library archives are kept.
VMS_ZIPDIR=`${UTIL_DIR}/getcfg Paths VMS_ZIPDIR`


# Now make a copy for transport to VMS
echo "Preparing ${DIR_NAME} for transport to vms"
cd ${FULL_NAME}

# Zip up the source-tree
/usr/bin/zip -r ${NAME} . ${NAME}
if ( [ ${?} -ne 0 ] ) then
    echo "Zipping operation failed in VMS preparation job!"
    exit 55
fi
echo "Zipping operation complete in VMS preparation job."

# Now ftp the library to the [cesrulib.cesr_libs] area on CESR2f
echo "Transferring file ${DIR_NAME}.zip to VMS machine CESR2f via FTP... "
echo "Destination = ${VMS_ZIPDIR}"
ftp cesr2f <<EOF
		binary
		cd $VMS_ZIPDIR
		put ${NAME}.zip
EOF
ftp_success=${?} # FIXME: Need better error checking here.

# Notify of completion
if ( [ ${ftp_success} -eq 0 ] ) then
    mv ${NAME}.zip ..
    echo "Transfer of ${NAME} to CESR2f::${VMS_ZIPDIR} complete!"
else
    echo "***ERROR! Transfer of ${NAME} to CESR2F FAILED!" 
    exit 0
fi

